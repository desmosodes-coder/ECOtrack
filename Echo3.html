<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOTrack - Transform Waste into Worth</title>
    <meta name="description" content="Join the green revolution with our comprehensive waste management platform. Track, reduce, and recycle your way to a sustainable future.">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Account dropdown styles */
        .account-dropdown {
            position: absolute;
            top: 60px;
            right: 20px;
            background: var(--surface);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 20px;
            width: 250px;
            z-index: 1000;
            display: none;
        }
        
        .account-dropdown.show {
            display: block;
        }
        
        .account-info {
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 15px;
        }
        
        .account-info h3 {
            margin: 0 0 5px 0;
            color: var(--text-primary);
        }
        
        .account-info p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .account-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .account-actions button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .account-actions button:hover {
            background: var(--primary-dark);
        }
        
        .logout-btn {
            background: var(--destructive) !important;
        }
        
        .logout-btn:hover {
            background: #b91c1c !important;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .overlay.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="#" id="logo-link">
                <span class="logo-icon">üå±</span>
                <span class="logo-text" data-testid="app-title">ECOTrack</span>
                </a>
            </div>
            
            <ul class="nav-menu" id="nav-menu">
                <li><a href="#" data-section="home" data-testid="nav-home">üè†<span class="nav-text">Home</span></a></li>
                <li><a href="#" data-section="info" data-testid="nav-info">üìä<span class="nav-text">Info</span></a></li>
                <li><a href="#" data-section="games" data-testid="nav-games">üéÆ<span class="nav-text">Games</span></a></li>
                <li><a href="#" data-section="tracker" data-testid="nav-tracker">üìà<span class="nav-text">Tracker</span></a></li>
                <li><a href="#" data-section="about" data-testid="nav-about">‚ÑπÔ∏è<span class="nav-text">About</span></a></li>
                <li><a href="#" data-section="settings" data-testid="nav-settings">‚öôÔ∏è<span class="nav-text">Settings</span></a></li>
            </ul>
        </div>
            
        <!-- Hamburger Menu Button -->
        <button class="hamburger" id="hamburger-menu" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </nav>
    
    <!-- Account Dropdown -->
    <div class="account-dropdown" id="accountDropdown">
        <div class="account-info">
            <h3 id="studentName">Student Name</h3>
            <p id="studentEmail">student@example.com</p>
            <p id="studentGrade">Grade: 5</p>
        </div>
        <div class="account-actions">
            <button class="logout-btn" id="logoutBtn">Log Out</button>
        </div>
    </div>
    
    <!-- Overlay for closing dropdown -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
        
        <!-- Home Section -->
        <section class="section active" id="home-section" data-testid="home-section">
            <div class="hero">
                <div class="hero-content">
                    <h1 data-key="hero.title">Transform Waste into Worth</h1>
                    <p data-key="hero.description">Join the green revolution with our comprehensive waste management platform. Track, reduce, and recycle your way to a sustainable future.</p>
                    <button class="cta-button" data-section="tracker" data-testid="cta-start-tracking" data-key="hero.cta">Start Tracking</button>
                </div>
                <div class="hero-image">
                    üåç
                </div>
            </div>

            <!-- Eco Bot Container -->
            <div class="eco-bot-container">
                <div class="eco-bot" id="eco-bot">
                    <div class="robot-body">
                        <div class="robot-head">
                            <div class="robot-eyes">
                                <div class="eye left-eye"></div>
                                <div class="eye right-eye"></div>
                            </div>
                            <div class="robot-antenna"></div>
                        </div>
                        <div class="robot-chest">
                            <div class="robot-panel"></div>
                        </div>
                        <div class="robot-wheels">
                            <div class="wheel left-wheel"></div>
                            <div class="wheel right-wheel"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Bubble -->
                <div class="chat-bubble" id="chat-bubble">
                    <div class="chat-content">
                        <h4>ü§ñ Eco Bot</h4>
                        <p>Hi! I am Eco Bot, your waste disposal guide. Click me to learn about proper waste management!</p>
                    </div>
                    <div class="chat-arrow"></div>
                </div>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">‚ôªÔ∏è</span>
                    <h3 data-key="features.recycling.title">Smart Recycling</h3>
                    <p data-key="features.recycling.description">Learn how to properly sort and recycle different materials with our intelligent guidance system.</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üìä</span>
                    <h3 data-key="features.analytics.title">Waste Analytics</h3>
                    <p data-key="features.analytics.description">Track your waste reduction progress with detailed analytics and environmental impact metrics.</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üèÜ</span>
                    <h3 data-key="features.rewards.title">Eco Rewards</h3>
                    <p data-key="features.rewards.description">Earn points for sustainable practices and redeem them for eco-friendly merchandise.</p>
                </div>
            </div>
            
            <!-- Eco Rewards Section -->
            <div class="eco-rewards-section">
                <div class="section-header">
                    <h2>Eco Rewards</h2>
                    <p>Complete tasks to earn virtual trophies</p>
                </div>
                
                <div class="rewards-grid">
                    <div class="reward-card" data-reward-id="1">
                        <div class="reward-icon">üèÜ</div>
                        <h3>First Steps</h3>
                        <p>Earn 50 points in any game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="2">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Recycling Master</h3>
                        <p>Earn 100 points in the sorting game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="3">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Memory Champion</h3>
                        <p>Earn 150 points in the memory game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="4">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Matching Expert</h3>
                        <p>Earn 200 points in the matching game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="5">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Eco Hero</h3>
                        <p>Earn 500 points across all games</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="6">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Difficulty Master</h3>
                        <p>Complete all games on nightmare difficulty</p>
                        <div class="reward-status">Locked</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Info Section -->
        <section class="section" id="info-section" data-testid="info-section">
            <div class="section-header">
                <h2 data-key="info.title">Waste Management Information</h2>
                <p data-key="info.subtitle">Learn about sustainable waste disposal practices</p>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <span class="info-icon">üîç</span>
                    <h3 data-key="info.categories.title">Waste Categories</h3>
                    <p data-key="info.categories.description">Organic waste should be composted to create nutrient-rich soil. Keep food scraps, yard trimmings, and biodegradable materials separate from other waste streams.</p>
                </div>
                <div class="info-card">
                    <span class="info-icon">üîÑ</span>
                    <h3 data-key="info.recycling.title">Recycling Guidelines</h3>
                    <p data-key="info.recycling.description">Clean containers before recycling. Remove caps and lids from bottles. Check local recycling programs for specific material acceptance policies.</p>
                </div>
                <div class="info-card">
                    <span class="info-icon">‚ö†Ô∏è</span>
                    <h3 data-key="info.hazardous.title">Hazardous Waste</h3>
                    <p data-key="info.hazardous.description">Electronics, batteries, chemicals, and medical waste require special disposal methods. Never put these items in regular trash or recycling bins.</p>
                </div>
                <div class="info-card">
                    <span class="info-icon">üí°</span>
                    <h3 data-key="info.reduction.title">Reduction Tips</h3>
                    <p data-key="info.reduction.description">Buy only what you need, choose reusable products, repair instead of replacing, and donate items in good condition to reduce overall waste generation.</p>
                </div>
                <div class="info-card">
                    <span class="info-icon">üå±</span>
                    <h3 data-key="info.composting.title">Composting Guide</h3>
                    <p data-key="info.composting.description">Create a balanced mix of green materials (food scraps) and brown materials (dry leaves, paper) for optimal composting conditions.</p>
                </div>
                <div class="info-card">
                    <span class="info-icon">üèüÔ∏è</span>
                    <h3 data-key="info.industrial.title">Industrial Waste</h3>
                    <p data-key="info.industrial.description">Businesses must follow specific regulations for waste disposal. Partner with certified waste management companies for proper handling and documentation.</p>
                </div>
            </div>
        </section>

        <!-- Games Section -->
        <section class="section" id="games-section" data-testid="games-section">
            <div class="section-header">
                <h2 data-key="games.title">Eco-Friendly Games</h2>
                <p data-key="games.subtitle">Learn while you play</p>
            </div>

            <div class="games-grid">
                <!-- Sorting Game -->
                <div class="game-card">
                    <span class="game-icon">üóëÔ∏è</span>
                    <h3>Waste Sorting Challenge</h3>
                    <p>Test your knowledge by correctly sorting different types of waste into appropriate bins. Earn points for accuracy!</p>
                    <button class="game-button" id="sorting-game-btn">Play Now</button>
                </div>
                
                <!-- Matching Game -->
                <div class="game-card">
                    <span class="game-icon">üß©</span>
                    <h3>Recycling Matching Game</h3>
                    <p>Match waste items with their correct disposal method. Improve your waste management knowledge while having fun!</p>
                    <button class="game-button" id="matching-game-btn">Start Game</button>
                </div>
                
                <!-- Memory Game -->
                <div class="game-card">
                    <span class="game-icon">üß†</span>
                    <h3>Eco Memory Game</h3>
                    <p>Flip cards to find matching pairs of waste items and their proper disposal methods. Challenge your memory and learn simultaneously!</p>
                    <button class="game-button" id="memory-game-btn">Play Game</button>
                </div>
            </div>
            
            <!-- Game Container -->
            <div id="game-container">
                <!-- Sorting Game Container -->
                <div id="sorting-game" class="game-content">
                    <h3>Waste Sorting Challenge</h3>
                    <div class="difficulty-selector">
                        <label>Select Difficulty:</label>
                        <select id="sorting-difficulty">
                            <option value="easy">Easy</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Hard</option>
                            <option value="nightmare">Nightmare</option>
                            <option value="impossible">Impossible</option>
                        </select>
                    </div>
                    <div class="timer-display">Time Left: <span id="sorting-timer">10:00</span></div>
                    <div class="game-info">
                        <p>Drag waste items to the correct bins. You have 60 seconds to sort as many items as possible!</p>
                        <div class="points-display">Points: <span id="sorting-points">0</span></div>
                    </div>
                    <div class="bins-container">
                        <div class="bin" data-bin-type="recyclable">
                            <h4>‚ôªÔ∏è Recyclable</h4>
                        </div>
                        <div class="bin" data-bin-type="organic">
                            <h4>üå± Organic</h4>
                        </div>
                        <div class="bin" data-bin-type="hazardous">
                            <h4>‚ö†Ô∏è Hazardous</h4>
                        </div>
                        <div class="bin" data-bin-type="general">
                            <h4>üóëÔ∏è General Waste</h4>
                        </div>
                    </div>
                    <div class="items-container" id="sorting-items">
                        <!-- Waste items will be generated here -->
                    </div>
                    <button class="reset-button" id="reset-sorting">Reset Game</button>
                </div>
                
                <!-- Matching Game Container -->
                <div id="matching-game" class="game-content">
                    <h3>Recycling Matching Game</h3>
                    <div class="difficulty-selector">
                        <label>Select Difficulty:</label>
                        <select id="matching-difficulty">
                            <option value="easy">Easy</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Hard</option>
                            <option value="nightmare">Nightmare</option>
                            <option value="impossible">Impossible</option>
                        </select>
                    </div>
                    <div class="timer-display">Time Left: <span id="matching-timer">10:00</span></div>
                    <div class="game-info">
                        <p>Match waste items with their correct disposal method. Find all pairs to win!</p>
                        <div class="points-display">Points: <span id="matching-points">0</span></div>
                    </div>
                    <div class="matching-board" id="matching-board">
                        <!-- Matching cards will be generated here -->
                    </div>
                    <button class="reset-button" id="reset-matching">Reset Game</button>
                </div>
                
                <!-- Memory Game Container -->
                <div id="memory-game" class="game-content">
                    <h3>Eco Memory Game</h3>
                    <div class="difficulty-selector">
                        <label>Select Difficulty:</label>
                        <select id="memory-difficulty">
                            <option value="easy">Easy</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Hard</option>
                            <option value="nightmare">Nightmare</option>
                            <option value="impossible">Impossible</option>
                        </select>
                    </div>
                    <div class="timer-display">Time Left: <span id="memory-timer">10:00</span></div>
                    <div class="game-info">
                        <p>Flip cards to find matching pairs. Complete the game with the least number of moves!</p>
                        <div class="points-display">Points: <span id="memory-points">0</span></div>
                    </div>
                    <div class="memory-board" id="memory-board">
                        <!-- Memory cards will be generated here -->
                    </div>
                    <button class="reset-button" id="reset-memory">Reset Game</button>
                </div>
            </div>
        </section>

        <!-- Tracker Section -->
        <section class="section" id="tracker-section" data-testid="tracker-section">
            <div class="section-header">
                <h2 data-key="tracker.title">Waste Disposal Calculator</h2>
                <p data-key="tracker.subtitle">Calculate your waste disposal needs</p>
            </div>

            <div class="calculator-container">
                <div class="calculator-card">
                    <h3>Waste Disposal Estimator</h3>
                    <div class="calculator-inputs">
                        <div class="input-group">
                            <label for="waste-frequency">How many times per week do you dispose of waste?</label>
                            <input type="number" id="waste-frequency" min="1" max="7" value="3">
                        </div>
                        
                        <div class="input-group">
                            <label for="waste-amount">Average amount of waste per disposal (in kg):</label>
                            <input type="number" id="waste-amount" min="1" value="10">
                        </div>
                        
                        <div class="input-group">
                            <label for="waste-type">Type of waste:</label>
                            <select id="waste-type">
                                <option value="general">General Waste</option>
                                <option value="recyclable">Recyclable Waste</option>
                                <option value="organic">Organic Waste</option>
                                <option value="hazardous">Hazardous Waste</option>
                                <option value="electronic">Electronic Waste</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="calculator-results">
                        <h4>Estimation Results</h4>
                        <div class="result-item">
                            <span>Daily Waste:</span>
                            <span id="daily-waste-result">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span>Weekly Waste:</span>
                            <span id="weekly-waste-result">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span>Monthly Waste:</span>
                            <span id="monthly-waste-result">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span>Yearly Waste:</span>
                            <span id="yearly-waste-result">0 kg</span>
                        </div>
                    </div>
                    
                    <button id="calculate-btn" class="calculate-button">Calculate</button>
                </div>
                
                <div class="tracker-cards">
                    <div class="tracker-card">
                        <span class="tracker-icon">üéØ</span>
                        <h3 data-key="tracker.goals.title">Goals & Achievements</h3>
                        <p data-key="tracker.goals.description">Track your waste disposal activities and set goals for reduction. Complete tasks to earn eco-points and badges!</p>
                        <div class="task-tracker">
                            <h4>Tasks to Complete</h4>
                            <ul class="task-list">
                                <li class="task-item">
                                    <input type="checkbox" id="task1">
                                    <label for="task1">Dispose of waste properly 5 times this week</label>
                                </li>
                                <li class="task-item">
                                    <input type="checkbox" id="task2">
                                    <label for="task2">Sort recyclable waste from general waste</label>
                                </li>
                                <li class="task-item">
                                    <input type="checkbox" id="task3">
                                    <label for="task3">Compost organic waste at least once</label>
                                </li>
                                <li class="task-item">
                                    <input type="checkbox" id="task4">
                                    <label for="task4">Reduce overall waste by 10% this month</label>
                                </li>
                            </ul>
                        </div>
                        <button class="tracker-button" data-testid="button-set-goals" data-key="tracker.goals.button">Set New Goals</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="section" id="about-section" data-testid="about-section">
            <div class="section-header">
                <h2 data-key="about.title">About ECOTrack</h2>
                <p data-key="about.subtitle">Our mission for a sustainable future</p>
            </div>

            <div class="about-grid">
                <div class="about-card">
                    <span class="about-icon">üéØ</span>
                    <h3 data-key="about.mission.title">Our Mission</h3>
                    <p data-key="about.mission.description">To create a world where waste is minimized, resources are conserved, and every individual contributes to environmental sustainability through informed actions and smart technology.</p>
                </div>
                <div class="about-card">
                    <span class="about-icon">üë•</span>
                    <h3 data-key="about.team.title">Our Team</h3>
                    <p data-key="about.team.description">A dedicated group of environmental scientists, software engineers, and sustainability experts working together to develop innovative solutions for waste management challenges.</p>
                </div>
                <div class="about-card">
                    <span class="about-icon">üåç</span>
                    <h3 data-key="about.impact.title">Global Impact</h3>
                    <p data-key="about.impact.description">Since our launch, ECOTrack users have diverted over 2 million pounds of waste from landfills and reduced carbon emissions by 15,000 tons through improved recycling practices.</p>
                </div>
                <div class="about-card">
                    <span class="about-icon">üî¨</span>
                    <h3 data-key="about.technology.title">Technology</h3>
                    <p data-key="about.technology.description">Our platform uses advanced analytics and machine learning to provide personalized waste reduction recommendations and track environmental impact in real-time.</p>
                </div>
                <div class="about-card">
                    <span class="about-icon">ü§ù</span>
                    <h3 data-key="about.partnerships.title">Partnerships</h3>
                    <p data-key="about.partnerships.description">We collaborate with local waste management companies, environmental organizations, and municipalities to create comprehensive sustainability programs.</p>
                </div>
                <div class="about-card">
                    <span class="about-icon">üìö</span>
                    <h3 data-key="about.education.title">Education</h3>
                    <p data-key="about.education.description">Through workshops, online resources, and community programs, we educate individuals and businesses about sustainable waste management practices.</p>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section class="section" id="settings-section" data-testid="settings-section">
            <div class="section-header">
                <h2 data-key="settings.title" data-testid="settings-title">Settings</h2>
                <p data-key="settings.subtitle" data-testid="settings-subtitle">Customize your ECOTrack experience</p>
            </div>
            
        </section>
    </main>

    <script type="module">
        // Import Firebase modules
        import { app, auth, database } from "./firebase-config.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        
        // Import existing script functionality
        import './script.js';
        import './eco-bot.js';

        // DOM Elements
        const logoLink = document.getElementById('logo-link');
        const accountDropdown = document.getElementById('accountDropdown');
        const overlay = document.getElementById('overlay');
        const logoutBtn = document.getElementById('logoutBtn');
        const studentName = document.getElementById('studentName');
        const studentEmail = document.getElementById('studentEmail');
        const studentGrade = document.getElementById('studentGrade');

        // Check authentication on page load
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // If not authenticated, redirect to login
                window.location.href = 'index.html';
                return;
            }
            
            // Load student data
            const studentRef = ref(database, "students/" + user.uid);
            onValue(studentRef, (snapshot) => {
                if (snapshot.exists()) {
                    const studentData = snapshot.val();
                    studentName.textContent = studentData.name;
                    studentEmail.textContent = studentData.email;
                    studentGrade.textContent = `Grade: ${studentData.grade}`;
                }
            });
        });

        // Toggle account dropdown
        logoLink.addEventListener('click', (e) => {
            e.preventDefault();
            accountDropdown.classList.toggle('show');
            overlay.classList.toggle('show');
        });

        // Close dropdown when clicking overlay
        overlay.addEventListener('click', () => {
            accountDropdown.classList.remove('show');
            overlay.classList.remove('show');
        });

        // Logout functionality
        logoutBtn.addEventListener('click', () => {
            // Calculate time spent and update database
            const startTime = sessionStorage.getItem('startTime');
            if (startTime) {
                const timeSpent = Math.floor((new Date().getTime() - parseInt(startTime)) / 1000); // in seconds
                
                const user = auth.currentUser;
                if (user) {
                    const studentRef = ref(database, "students/" + user.uid);
                    // Update total time spent
                    update(studentRef, {
                        totalTimeSpent: timeSpent
                    }).then(() => {
                        signOut(auth).then(() => {
                            window.location.href = 'index.html';
                        });
                    });
                }
            } else {
                signOut(auth).then(() => {
                    window.location.href = 'index.html';
                });
            }
        });
    </script>
</body>
</html>