<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOTrack - Transform Waste into Worth</title>
    <meta name="description" content="Join the green revolution with our comprehensive waste management platform. Track, reduce, and recycle your way to a sustainable future.">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Falling Leaves Animation */
        .falling-leaves-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .leaf {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #2d7d4a, #43a862);
            border-radius: 0 100% 0 100%;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(calc(100vh + 100px)) rotate(360deg);
                opacity: 0;
            }
        }

        /* Theme-based leaf colors */
        [data-theme="light"] .leaf {
            background: linear-gradient(45deg, #2d7d4a, #43a862);
        }

        [data-theme="dark"] .leaf {
            background: linear-gradient(45deg, #1e5535, #2d7d4a);
        }

        [data-theme="forest"] .leaf {
            background: linear-gradient(45deg, #16a34a, #22c55e);
        }

        /* Waste Information Styles */
        .waste-info-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .waste-intro {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .waste-intro-content h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .waste-intro-content p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .waste-image {
            width: 100%;
            max-width: 400px;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
        }

        .waste-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .comparison-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .comparison-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px var(--shadow);
        }

        .comparison-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .waste-type-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .comparison-card p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .comparison-card ul {
            list-style: none;
            padding-left: 0;
        }

        .comparison-card li {
            color: var(--text-secondary);
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .comparison-card li:before {
            content: "üåø ";
            margin-right: 0.5rem;
        }

        .waste-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .waste-type-card {
            background: var(--surface);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .waste-type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px var(--shadow);
        }

        .waste-card-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .waste-type-card h4 {
            color: var(--primary);
            padding: 1rem 1rem 0.5rem;
            font-size: 1.3rem;
        }

        .waste-type-card p {
            color: var(--text-secondary);
            padding: 0 1rem 1rem;
            line-height: 1.6;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .waste-info-container {
                padding: 1rem;
            }
            
            .waste-intro {
                padding: 1.5rem;
            }
            
            .comparison-card {
                padding: 1.5rem;
            }
            
            .waste-types-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ===== Profile Slide-up Panel Styles ===== */
    .profile-panel {
      position: fixed;
      left: 0;
      right: 0;
      bottom: -100%;
      max-height: 92vh;
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(240,255,245,0.96));
      color: #042a18;
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      box-shadow: 0 -20px 40px rgba(3,60,37,0.25);
      transition: bottom 360ms cubic-bezier(.2,.9,.2,1);
      z-index: 99999;
      padding: 18px;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
    .profile-panel.open { bottom: 0; }

    /* header */
    .profile-header {
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 12px;
    }
    .profile-left {
      display:flex;
      gap:12px;
      align-items:center;
    }

    .profile-avatar {
      width:72px;
      height:72px;
      border-radius:50%;
      background: linear-gradient(135deg,#e6fff3,#c8fbe6);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border:3px solid rgba(6,62,37,0.06);
      box-shadow:0 6px 18px rgba(6,62,37,0.08);
    }
    .profile-avatar img { width:100%; height:100%; object-fit:cover; }

    .profile-name { font-weight:700; font-size:18px; color:#05321f; }
    .profile-email { font-size:13px; color:#2f6a50; opacity:0.9; }

    .profile-actions { display:flex; gap:8px; align-items:center; }

    .btn-small {
      padding:8px 12px;
      border-radius:10px;
      border: none;
      cursor:pointer;
      font-weight:600;
      background:#198754;
      color:white;
      box-shadow: 0 6px 14px rgba(0,140,80,0.08);
    }
    .btn-ghost {
      background:transparent;
      border:1px solid rgba(6,62,37,0.08);
      color:#05321f;
    }

    /* profile content grid */
    .profile-grid {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:10px;
    }

    .profile-card {
      background: white;
      border-radius:12px;
      padding:12px;
      box-shadow: 0 6px 14px rgba(5,50,34,0.04);
      border:1px solid rgba(6,62,37,0.03);
    }
    .profile-card h4 { margin:0 0 8px 0; color:#065033; font-size:14px; }
    .profile-field { width:100%; padding:8px; border-radius:8px; border:1px solid rgba(6,62,37,0.06); font-size:14px; }

    .profile-footer {
      margin-top:12px;
      display:flex;
      gap:8px;
      justify-content:space-between;
      align-items:center;
    }

    .toggle {
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
    }
    .toggle input { width: 18px; height:18px; }

    /* small screens adjustments */
    @media (max-width:720px) {
      .profile-grid { grid-template-columns: 1fr; }
      .profile-avatar { width:64px; height:64px; }
      .profile-panel { padding:12px; }
      .btn-small { padding:8px 10px; font-size:14px; }
    }

    /* overlay behind panel */
    .profile-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.36);
      opacity:0;
      pointer-events:none;
      transition: opacity 240ms ease;
      z-index: 99998;
    }
    .profile-overlay.show { opacity:1; pointer-events:all; }

    /* small helper styles */
    .muted { color:#476b59; font-size:13px; }
    .center { text-align:center; }
    .input-file { display:none; }

    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="#" class="logo-link" id="logoTrigger">
                <span class="logo-icon">üå±</span>
                <span class="logo-text" data-testid="app-title">ECOTrack</span>
                </a>
            </div>
            
            <ul class="nav-menu" id="nav-menu">
                <li><a href="#" data-section="home" data-testid="nav-home">üè†<span class="nav-text">Home</span></a></li>
                <li><a href="#" data-section="waste-information" data-testid="nav-waste-information">üóëÔ∏è<span class="nav-text">Waste Information</span></a></li>
                <li><a href="#" data-section="games" data-testid="nav-games">üéÆ<span class="nav-text">Games</span></a></li>
                <li><a href="#" data-section="tracker" data-testid="nav-tracker">üìà<span class="nav-text">Tracker</span></a></li>
                <li><a href="#" data-section="settings" data-testid="nav-settings">‚öôÔ∏è<span class="nav-text">Settings</span></a></li>
            </ul>
        </div>
            
            <!-- Hamburger Menu Button -->
            <button class="hamburger" id="hamburger-menu" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
        
        <!-- Home Section -->
        <section class="section active" id="home-section" data-testid="home-section">
            <div class="hero">
                <div class="hero-content">
                    <h1 data-key="hero.title">Transform Waste into Worth</h1>
                    <p data-key="hero.description">Join the green revolution with our comprehensive waste management platform. Track, reduce, and recycle your way to a sustainable future.</p>
                    <button class="cta-button" data-section="tracker" data-testid="cta-start-tracking" data-key="hero.cta">Start Tracking</button>
                </div>
                <div class="hero-image">
                    üåç
                </div>
            </div>

            <!-- Eco Bot Container -->
            <div class="eco-bot-container">
                <div class="eco-bot" id="eco-bot">
                    <div class="robot-body">
                        <div class="robot-head">
                            <div class="robot-eyes">
                                <div class="eye left-eye"></div>
                                <div class="eye right-eye"></div>
                            </div>
                            <div class="robot-antenna"></div>
                        </div>
                        <div class="robot-chest">
                            <div class="robot-panel"></div>
                        </div>
                        <div class="robot-wheels">
                            <div class="wheel left-wheel"></div>
                            <div class="wheel right-wheel"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Bubble -->
                <div class="chat-bubble" id="chat-bubble">
                    <div class="chat-content">
                        <h4>ü§ñ Eco Bot</h4>
                        <p>Hi! I am Eco Bot, your waste disposal guide. Click me to learn about proper waste management!</p>
                    </div>
                    <div class="chat-arrow"></div>
                </div>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">‚ôªÔ∏è</span>
                    <h3 data-key="features.recycling.title">Smart Recycling</h3>
                    <p data-key="features.recycling.description">Learn how to properly sort and recycle different materials with our intelligent guidance system.</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üìä</span>
                    <h3 data-key="features.analytics.title">Waste Analytics</h3>
                    <p data-key="features.analytics.description">Track your waste reduction progress with detailed analytics and environmental impact metrics.</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üèÜ</span>
                    <h3 data-key="features.rewards.title">Eco Rewards</h3>
                    <p data-key="features.rewards.description">Earn points for sustainable practices and redeem them for eco-friendly merchandise.</p>
                </div>
            </div>
            
            <!-- Eco Rewards Section -->
            <div class="eco-rewards-section">
                <div class="section-header">
                    <h2>Eco Rewards</h2>
                    <p>Complete tasks to earn virtual trophies</p>
                </div>
                
                <div class="rewards-grid">
                    <div class="reward-card" data-reward-id="1">
                        <div class="reward-icon">üèÜ</div>
                        <h3>First Steps</h3>
                        <p>Earn 50 points in any game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="2">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Recycling Master</h3>
                        <p>Earn 100 points in the sorting game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="3">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Memory Champion</h3>
                        <p>Earn 150 points in the memory game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="4">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Matching Expert</h3>
                        <p>Earn 200 points in the matching game</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="5">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Eco Hero</h3>
                        <p>Earn 500 points across all games</p>
                        <div class="reward-status">Locked</div>
                    </div>
                    <div class="reward-card" data-reward-id="6">
                        <div class="reward-icon">üèÜ</div>
                        <h3>Difficulty Master</h3>
                        <p>Complete all games on nightmare difficulty</p>
                        <div class="reward-status">Locked</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Info Section -->
        <!-- Waste Information Section -->
        <section class="section" id="waste-information-section" data-testid="waste-information-section">
            <div class="section-header">
                <h2>üåà Kids Waste Disposal Guide üåà</h2>
                <p>Learn about biodegradable and non-biodegradable waste through fun activities!</p>
            </div>

            <div class="waste-info-container">
                <!-- What is Waste Disposal -->
                <div class="waste-intro">
                    <div class="waste-intro-content">
                        <h3>üåç What is Waste Disposal, Kids? üåç</h3>
                        <p>Waste disposal is the process of managing and getting rid of waste materials in a safe, environmentally responsible manner. Proper waste disposal helps protect our environment, conserves natural resources, and prevents pollution of air, water, and soil.</p>
                        <img src="https://picsum.photos/seed/wastedisposal/400/300.jpg" alt="Waste Disposal Process" class="waste-image">
                    </div>
                </div>

                <!-- Biodegradable vs Non-Biodegradable -->
                <div class="waste-comparison">
                    <div class="comparison-card">
                        <h3>üå± Biodegradable Waste</h3>
                        <img src="https://picsum.photos/seed/biodegradable/300/200.jpg" alt="Biodegradable Waste" class="waste-type-image">
                        <p>Biodegradable waste breaks down naturally through biological processes. This includes food scraps, yard waste, paper, and other organic materials that can be composted.</p>
                        <ul>
                            <li>Food scraps and leftovers</li>
                            <li>Yard trimmings and leaves</li>
                            <li>Paper and cardboard</li>
                            <li>Wood and natural fibers</li>
                        </ul>
                    </div>
                    <div class="comparison-card">
                        <h3>‚öôÔ∏è Non-Biodegradable Waste</h3>
                        <img src="https://picsum.photos/seed/nonbiodegradable/300/200.jpg" alt="Non-Biodegradable Waste" class="waste-type-image">
                        <p>Non-biodegradable waste does not break down naturally and can persist in the environment for hundreds of years. These materials require special disposal or recycling methods.</p>
                        <ul>
                            <li>Plastics and synthetic materials</li>
                            <li>Metal and aluminum</li>
                            <li>Glass products</li>
                            <li>Electronic components</li>
                        </ul>
                    </div>
                </div>

                <!-- Waste Types Grid -->
                <div class="waste-types-grid">
                    <div class="waste-type-card">
                        <img src="https://picsum.photos/seed/generalwaste/250/180.jpg" alt="General Waste" class="waste-card-image">
                        <h4>üóëÔ∏è General Waste</h4>
                        <p>General waste includes non-recyclable household items that cannot be composted or recycled. This goes to landfills and should be minimized.</p>
                    </div>
                    
                    <div class="waste-type-card">
                        <img src="https://picsum.photos/seed/ewaste/250/180.jpg" alt="Electronic Waste" class="waste-card-image">
                        <h4>üíª Electronic Waste</h4>
                        <p>E-waste includes old computers, phones, batteries, and other electronic devices. These contain valuable materials and hazardous substances requiring special handling.</p>
                    </div>
                    
                    <div class="waste-type-card">
                        <img src="https://picsum.photos/seed/recyclable/250/180.jpg" alt="Recyclable Waste" class="waste-card-image">
                        <h4>‚ôªÔ∏è Recyclable Waste</h4>
                        <p>Recyclable materials can be processed and used to create new products. This includes paper, plastic, glass, and metal that can be sorted and reprocessed.</p>
                    </div>
                    
                    <div class="waste-type-card">
                        <img src="https://picsum.photos/seed/organicwaste/250/180.jpg" alt="Organic Waste" class="waste-card-image">
                        <h4>üåø Organic Waste</h4>
                        <p>Organic waste comes from plant and animal sources and can be composted. This includes food scraps, yard waste, and other biodegradable materials.</p>
                    </div>
                    
                    <div class="waste-type-card">
                        <img src="https://picsum.photos/seed/hazardous/250/180.jpg" alt="Hazardous Waste" class="waste-card-image">
                        <h4>‚ò£Ô∏è Hazardous Waste</h4>
                        <p>Hazardous waste contains harmful substances that can endanger human health or the environment. This includes chemicals, paints, batteries, and medical waste.</p>
                    </div>
                </div>
            </div>

            <!-- Falling Leaves Animation Container -->
            <div class="falling-leaves-container"></div>
        </section>

        <!-- Games Section -->
        <section class="section" id="games-section" data-testid="games-section">
            <div class="section-header">
                <h2 data-key="games.title">üåà Kids Eco-Friendly Games üåà</h2>
                <p data-key="games.subtitle">Learn about biodegradable & non-biodegradable waste while having fun!</p>
            </div>

            <div class="games-grid">
                <!-- Sorting Game -->
                <div class="game-card">
                    <span class="game-icon">üóëÔ∏è</span>
                <!-- Biodegradable Sorting Game -->
                <div class="game-card colorful-card sorting-game">
                    <span class="game-icon">üåàüóÇÔ∏è</span>
                    <h3>Biodegradable Sorting üå±</h3>
                    <p>Help sort biodegradable and non-biodegradable waste into colorful bins! Race against time and earn points!</p>
                    <div class="game-stats">
                        <span>‚è±Ô∏è Time Challenge</span>
                        <span>üèÜ Points System</span>
                    </div>
                    <button class="game-button rainbow-btn" id="biodegradable-sorting-btn">Play Now! üéÆ</button>
                </div>
                
                <!-- Waste Matching Game -->
                <div class="game-card colorful-card matching-game">
                    <span class="game-icon">üéØüß©</span>
                    <h3>Waste Matching Game üé™</h3>
                    <p>Match waste items with their correct disposal categories! Perfect matches earn bonus points!</p>
                    <div class="game-stats">
                        <span>‚è±Ô∏è Speed Bonus</span>
                        <span>üèÜ Perfect Matches</span>
                    </div>
                    <button class="game-button rainbow-btn" id="waste-matching-btn">Start Game! üöÄ</button>
                </div>
                
                <!-- Waste Spelling Game -->
                <div class="game-card colorful-card spelling-game">
                    <span class="game-icon">‚úèÔ∏èüìù</span>
                    <h3>Waste Word Spelling üìö</h3>
                    <p>Learn to spell important waste disposal words while earning points for each correct letter!</p>
                    <div class="game-stats">
                        <span>‚è±Ô∏è Time Pressure</span>
                        <span>üèÜ Letter Points</span>
                    </div>
                    <button class="game-button rainbow-btn" id="waste-spelling-btn">Play Game! üåü</button>
                </div>

                <!-- Waste Puzzle Game -->
                <div class="game-card colorful-card puzzle-game">
                    <span class="game-icon">üß©üåç</span>
                    <h3>Waste Disposal Puzzle üß©</h3>
                    <p>Solve fun puzzles about proper waste disposal! Challenge your brain and save the planet!</p>
                    <div class="game-stats">
                        <span>‚è±Ô∏è Brain Challenge</span>
                        <span>üèÜ Smart Solutions</span>
                    </div>
                    <button class="game-button rainbow-btn" id="waste-puzzle-btn">Play Game! üéØ</button>
                </div>

                <!-- Waste Memory Game -->
                <div class="game-card colorful-card memory-game">
                    <span class="game-icon">üß†üé≤</span>
                    <h3>Waste Memory Game üéÆ</h3>
                    <p>Test your memory by matching waste cards with their disposal methods! Can you find all pairs?</p>
                    <div class="game-stats">
                        <span>‚è±Ô∏è Memory Test</span>
                        <span>üèÜ Match Master</span>
                    </div>
                    <button class="game-button rainbow-btn" id="waste-memory-btn">Play Game! üèÜ</button>
                </div>
                <div id="sorting-game" class="game-content">
                    <h3>Waste Sorting Challenge</h3>
                    <div class="difficulty-selector">
                        <label>Select Difficulty:</label>
                        <select id="sorting-difficulty">
                            <option value="easy">Easy</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Hard</option>
                            <option value="nightmare">Nightmare</option>
                            <option value="impossible">Impossible</option>
                        </select>
                    </div>
                    <div class="timer-display">Time Left: <span id="sorting-timer">10:00</span></div>
                    <div class="game-info">
                        <p>Drag waste items to the correct bins. You have 60 seconds to sort as many items as possible!</p>
                        <div class="points-display">Points: <span id="sorting-points">0</span></div>
                    </div>
                    <div class="bins-container">
                        <div class="bin" data-bin-type="recyclable">
                            <h4>‚ôªÔ∏è Recyclable</h4>
                        </div>
                        <div class="bin" data-bin-type="organic">
                            <h4>üå± Organic</h4>
                        </div>
                        <div class="bin" data-bin-type="hazardous">
                            <h4>‚ö†Ô∏è Hazardous</h4>
                        </div>
                        <div class="bin" data-bin-type="general">
                            <h4>üóëÔ∏è General Waste</h4>
                        </div>
                    </div>
                    <div class="items-container" id="sorting-items">
                        <!-- Waste items will be generated here -->
                    </div>
                    <button class="reset-button" id="reset-sorting">Reset Game</button>
                </div>
                
                <!-- Matching Game Container -->
                <div id="matching-game" class="game-content">
                    <h3>Recycling Matching Game</h3>
                    <div class="difficulty-selector">
                        <label>Select Difficulty:</label>
                        <select id="matching-difficulty">
                            <option value="easy">Easy</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Hard</option>
                            <option value="nightmare">Nightmare</option>
                            <option value="impossible">Impossible</option>
                        </select>
                    </div>
                    <div class="timer-display">Time Left: <span id="matching-timer">10:00</span></div>
                    <div class="game-info">
                        <p>Match waste items with their correct disposal method. Find all pairs to win!</p>
                        <div class="points-display">Points: <span id="matching-points">0</span></div>
                    </div>
                    <div class="matching-board" id="matching-board">
                        <!-- Matching cards will be generated here -->
                    </div>
                    <button class="reset-button" id="reset-matching">Reset Game</button>
                </div>
                
                <!-- Memory Game Container -->
                <div id="memory-game" class="game-content">
                    <h3>Eco Memory Game</h3>
                    <div class="difficulty-selector">
                        <label>Select Difficulty:</label>
                        <select id="memory-difficulty">
                            <option value="easy">Easy</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Hard</option>
                            <option value="nightmare">Nightmare</option>
                            <option value="impossible">Impossible</option>
                        </select>
                    </div>
                    <div class="timer-display">Time Left: <span id="memory-timer">10:00</span></div>
                    <div class="game-info">
                        <p>Flip cards to find matching pairs. Complete the game with the least number of moves!</p>
                        <div class="points-display">Points: <span id="memory-points">0</span></div>
                    </div>
                    <div class="memory-board" id="memory-board">
                        <!-- Memory cards will be generated here -->
                    </div>
                    <button class="reset-button" id="reset-memory">Reset Game</button>
                </div>
               <!-- Game Container for Dynamic Game Content -->
               <div id="game-container" class="game-container"></div>
            </div>
        </section>

        <!-- Tracker Section -->
        <section class="section" id="tracker-section" data-testid="tracker-section">
            <div class="section-header">
                <h2 data-key="tracker.title">üå± Kids Waste Tracker üå±</h2>
                <p data-key="tracker.subtitle">Track your waste and help save the Earth!</p>
            </div>

            <div class="tracker-container">
                <!-- Waste Type Selection -->
                <div class="waste-type-selector">
                    <h3>üóÇÔ∏è What type of waste is it?</h3>
                    <div class="waste-type-options">
                        <label class="waste-type-option">
                            <input type="radio" name="waste-type" value="biodegradable" checked>
                            <span class="waste-icon">üçÉ</span>
                            <span class="waste-label">Biodegradable</span>
                            <span class="waste-desc">(Like food scraps, paper)</span>
                        </label>
                        <label class="waste-type-option">
                            <input type="radio" name="waste-type" value="non-biodegradable">
                            <span class="waste-icon">ü•§</span>
                            <span class="waste-label">Non-Biodegradable</span>
                            <span class="waste-desc">(Like plastic, metal)</span>
                        </label>
                    </div>
                </div>

                <!-- Image Drop Zone -->
                <div class="drop-zone-container">
                    <h3>üì∏ Take a picture of your waste!</h3>
                    <div id="drop-zone" class="drop-zone">
                        <div class="drop-zone-content">
                            <span class="drop-icon">üì∑</span>
                            <p class="drop-text">Drag & drop your waste picture here</p>
                            <p class="drop-subtext">or click to browse</p>
                            <input type="file" id="file-input" accept="image/*" multiple>
                        </div>
                    </div>
                    <div id="image-preview" class="image-preview"></div>
                </div>

                <!-- Calculate Button -->
                <div class="calculate-section">
                    <button id="calculate-btn" class="fun-calculate-button" disabled>
                        <span class="btn-icon">üßÆ</span>
                        <span class="btn-text">Calculate My Waste!</span>
                    </button>
                    <p class="calc-info">‚ú® You need to add a picture before calculating!</p>
                </div>

                <!-- Results Display -->
                <div id="results-display" class="results-display" style="display: none;">
                    <h3>üéä Your Waste Results! üéä</h3>
                    <div class="result-cards">
                        <div class="result-card">
                            <span class="result-icon">‚öñÔ∏è</span>
                            <span class="result-label">Total Items:</span>
                            <span id="total-items" class="result-value">0</span>
                        </div>
                        <div class="result-card">
                            <span class="result-icon">üåç</span>
                            <span class="result-label">Earth Impact:</span>
                            <span id="earth-impact" class="result-value">Good!</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Section -->
            <div class="history-section">
                <h3>üìö Your Waste History üìö</h3>
                <div id="history-container" class="history-container">
                    <div class="empty-history">
                        <span class="empty-icon">üåü</span>
                        <p>No waste tracked yet. Start tracking to see your history!</p>
                    </div>
                </div>
                <button id="clear-history" class="clear-button" style="display: none;">
                    <span class="btn-icon">üóëÔ∏è</span>
                    Clear All History
                </button>
            </div>
                        
                        <div class="input-group">
                            <label for="waste-amount">Average amount of waste per disposal (in kg):</label>
                            <input type="number" id="waste-amount" min="1" value="10">
                        </div>
                        
                        <div class="input-group">
                            <label for="waste-category">Waste Category:</label>
                            <select id="waste-category">
                                <option value="biodegradable">Biodegradable</option>
                                <option value="non-biodegradable">Non-Biodegradable</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="calculator-results">
                        <h4>Estimation Results</h4>
                        <div class="result-item">
                            <span>Daily Waste:</span>
                            <span id="daily-waste-result">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span>Weekly Waste:</span>
                            <span id="weekly-waste-result">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span>Monthly Waste:</span>
                            <span id="monthly-waste-result">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span>Yearly Waste:</span>
                            <span id="yearly-waste-result">0 kg</span>
                        </div>
                        <div class="result-item category-info">
                            <span>Category Impact:</span>
                            <span id="category-impact-result">-</span>
                        </div>
                    </div>
                    
                    <button id="calculate-btn" class="calculate-button">Calculate</button>
                </div>
                
                <div class="tracker-cards">
                    <div class="tracker-card">
                        <span class="tracker-icon">üéØ</span>
                        <h3 data-key="tracker.goals.title">Goals & Achievements</h3>
                        <p data-key="tracker.goals.description">Track your waste disposal activities and set goals for reduction. Complete tasks to earn eco-points and badges!</p>
                        <div class="task-tracker">
                            <h4>Tasks to Complete</h4>
                            <ul class="task-list">
                                <li class="task-item">
                                    <input type="checkbox" id="task1">
                                    <label for="task1">Dispose of waste properly 5 times this week</label>
                                </li>
                                <li class="task-item">
                                    <input type="checkbox" id="task2">
                                    <label for="task2">Sort recyclable waste from general waste</label>
                                </li>
                                <li class="task-item">
                                    <input type="checkbox" id="task3">
                                    <label for="task3">Compost organic waste at least once</label>
                                </li>
                                <li class="task-item">
                                    <input type="checkbox" id="task4">
                                    <label for="task4">Reduce overall waste by 10% this month</label>
                                </li>
                            </ul>
                        </div>
                        <button class="tracker-button" data-testid="button-set-goals" data-key="tracker.goals.button">Set New Goals</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        </section>

        <!-- Settings Section -->
        <section class="section" id="settings-section" data-testid="settings-section">
            <div class="section-header">
                <h2 data-key="settings.title" data-testid="settings-title">Settings</h2>
                <p data-key="settings.subtitle" data-testid="settings-subtitle">Customize your ECOTrack experience</p>
            </div>

            <div class="settings-grid">
                <!-- Theme Selection -->
                <div class="settings-card" data-testid="theme-settings">
                    <span class="settings-icon">üé®</span>
                    <h3 data-key="settings.theme.title">Choose Theme</h3>
                    <div class="theme-options">
                        <div class="theme-option light-theme" data-testid="theme-light" data-theme="light">
                            <span class="theme-name" data-key="settings.theme.light">Light</span>
                        </div>
                        <div class="theme-option dark-theme" data-testid="theme-dark" data-theme="dark">
                            <span class="theme-name" data-key="settings.theme.dark">Dark</span>
                        </div>
                        <div class="theme-option forest-theme" data-testid="theme-forest" data-theme="forest">
                            <span class="theme-name" data-key="settings.theme.forest">Forest</span>
                        </div>
                        <div class="theme-option ocean-theme" data-testid="theme-ocean" data-theme="ocean">
                            <span class="theme-name" data-key="settings.theme.ocean">Ocean</span>
                        </div>
                        <div class="theme-option sunset-theme" data-testid="theme-sunset" data-theme="sunset">
                            <span class="theme-name" data-key="settings.theme.sunset">Sunset</span>
                        </div>
                    </div>
                    <p data-key="settings.theme.description">Choose from our collection of beautiful themes to personalize your ECOTrack experience.</p>
                </div>

                <!-- Audio Controls -->

                <!-- Language Selection -->
                <div class="settings-card" data-testid="language-settings">
                    <span class="settings-icon">üåê</span>
                    <h3 data-key="settings.language.title">Language / Idioma</h3>
                    <div class="language-options">
                        <button class="language-option" data-testid="language-en" data-language="en">
                            <span class="flag">üá∫üá∏</span>
                            <div class="language-info">
                                <div class="language-name">English</div>
                                <div class="language-region">United States</div>
                            </div>
                        </button>
                        <button class="language-option" data-testid="language-fil" data-language="fil">
                            <span class="flag">üáµüá≠</span>
                            <div class="language-info">
                                <div class="language-name">Filipino</div>
                                <div class="language-region">Pilipinas</div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="settings-card">
                    <span class="settings-icon">üîî</span>
                    <h3 data-key="settings.notifications.title">Notifications</h3>
                    <p data-key="settings.notifications.description">Manage your notification preferences for reminders, achievements, and weekly reports.</p>
                    <button class="settings-button" data-testid="button-configure-notifications" data-key="settings.notifications.button">Configure Notifications</button>
                </div>

                <!-- Privacy -->
                <div class="settings-card">
                    <span class="settings-icon">üìä</span>
                    <h3 data-key="settings.settings.privacy.title">Data & Privacy</h3>
                    <p data-key="settings.privacy.description">Control your data sharing preferences and privacy settings for a personalized experience.</p>
                    <button class="settings-button" data-testid="button-privacy-settings" data-key="settings.privacy.button">Privacy Settings</button>
                </div>
            </div>
        </section>

    </main>

     <!-- Profile Overlay and Panel -->
  <div id="profileOverlay" class="profile-overlay" aria-hidden="true"></div>

  <aside id="profilePanel" class="profile-panel" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="profile-header">
      <div class="profile-left">
        <label for="profileImageInput" title="Change profile picture" style="cursor:pointer;">
          <div class="profile-avatar" id="profileAvatar" aria-hidden="true">
            <!-- image injected by JS -->
            <img src="" alt="Profile picture" id="profileAvatarImg" style="display:none;">
            <div id="profileInitials" style="font-weight:700;color:#0b3f25;font-size:22px;">ET</div>
          </div>
        </label>
        <input type="file" id="profileImageInput" accept="image/*" class="input-file">

        <div>
          <div class="profile-name" id="profileFullName">Loading...</div>
          <div class="profile-email" id="profileEmail">‚Äî</div>
        </div>
      </div>

      <div class="profile-actions">
        <button id="editProfileBtn" class="btn-small btn-ghost">Edit</button>
        <button id="logoutBtn" class="btn-small">Logout</button>
        <button id="closeProfile" class="btn-small btn-ghost">Close</button>
      </div>
    </div>

    <div class="profile-grid">
      <div class="profile-card">
        <h4>Personal Details</h4>
        <input id="fieldFullName" class="profile-field" placeholder="Full name" />
        <input id="fieldEmail" class="profile-field" placeholder="Email" disabled />
        <input id="fieldAge" class="profile-field" type="number" placeholder="Age" min="1" />
      </div>

      <div class="profile-card">
        <h4>School Info</h4>
        <select id="fieldGrade" class="profile-field">
          <option value="">Select Grade</option>
          <option>Grade 11</option>
          <option>Grade 12</option>
        </select>
        <input id="fieldSection" class="profile-field" placeholder="Section / Advisory" />
        <input id="fieldPoints" class="profile-field" placeholder="Points" readonly />
        <div style="margin-top:8px;">
          <div class="muted">Verification status: <strong id="fieldVerified">‚Äî</strong></div>
        </div>
      </div>

      <div class="profile-card" style="grid-column:1 / -1;">
        <h4>Account & Security</h4>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button id="saveProfileBtn" class="btn-small">Save Changes</button>
          <button id="sendResetBtn" class="btn-small btn-ghost">Send Password Reset Email</button>
          <button id="deleteAccountBtn" class="btn-small btn-ghost" style="background:#ffecec;color:#7a1b1b;border:1px solid rgba(255,0,0,0.06)">Delete Account</button>
        </div>
        <div style="margin-top:8px;" class="muted">Delete account will remove user authentication (requires admin action in Firestore cleanup). Use carefully.</div>
      </div>
    </div>

    <div class="profile-footer">
      <div>
        <div class="toggle" id="themeToggle">
          <input type="checkbox" id="themeCheckbox" />
          <label for="themeCheckbox" class="muted">Dark Mode</label>
        </div>
      </div>

      <div class="center">
        <small class="muted">Last synced: <span id="lastSynced">‚Äî</span></small>
      </div>
    </div>

  </aside>

    <!-- Notification -->
    <div class="notification" id="notification"></div>


    <script>
        // Falling Leaves Animation
        function createFallingLeaves() {
            const container = document.querySelector(".falling-leaves-container");
            if (!container) return;
            
            // Clear existing leaves
            container.innerHTML = "";
            
            // Create leaves
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const leaf = document.createElement("div");
                    leaf.className = "leaf";
                    
                    // Random position
                    leaf.style.left = Math.random() * 100 + "%";
                    
                    // Random animation duration
                    const duration = 8 + Math.random() * 12;
                    leaf.style.animationDuration = duration + "s";
                    
                    // Random delay
                    leaf.style.animationDelay = Math.random() * 5 + "s";
                    
                    // Random size
                    const size = 15 + Math.random() * 10;
                    leaf.style.width = size + "px";
                    leaf.style.height = size + "px";
                    
                    container.appendChild(leaf);
                }, i * 300);
            }
        }

        // Initialize falling leaves when waste information section is shown
        function initWasteInformationSection() {
            const wasteInfoSection = document.getElementById("waste-information-section");
            if (!wasteInfoSection) return;
            
            // Create observer to detect when section becomes visible
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        createFallingLeaves();
                    }
                });
            }, { threshold: 0.1 });
            
            observer.observe(wasteInfoSection);
        }

        // Update falling leaves when theme changes
        function updateLeavesForTheme() {
            const leaves = document.querySelectorAll(".leaf");
            leaves.forEach(leaf => {
                // Force re-render to apply new theme colors
                leaf.style.display = "none";
                setTimeout(() => {
                    leaf.style.display = "";
                }, 10);
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener("DOMContentLoaded", function() {
            initWasteInformationSection();
            
            // Listen for theme changes
            const themeButtons = document.querySelectorAll("[data-theme]");
            themeButtons.forEach(button => {
                button.addEventListener("click", function() {
                    setTimeout(updateLeavesForTheme, 100);
                });
            });
        });
    </script>
    <script src="script.js"></script>
    <script src="ecobot.js"></script>
       <script src="script waste info.js"></script>
       <script src="kids game.js"></script>
          <script src="waste_tracker_functionality.js"></script>
          <script src="enhanced-calculator.js"></script>
<script src="complete-translations.js"></script>
<script src="filipino-translations.js"></script>

<script type="module" defer>
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    // --- Use same config as your index.html ---
    const firebaseConfig = {
      apiKey: "AIzaSyAvblGiAIZ26bIbtw6cSv9kfgzSiYyq_10",
      authDomain: "registar-5f3fb.firebaseapp.com",
      projectId: "registar-5f3fb",
      storageBucket: "registar-5f3fb.firebasestorage.app",
      messagingSenderId: "856198150739",
      appId: "1:856198150739:web:801000f564b47f6333e4a6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // UI refs
    const logoTrigger = document.getElementById('logoTrigger');
    const profilePanel = document.getElementById('profilePanel');
    const profileOverlay = document.getElementById('profileOverlay');
    const closeProfile = document.getElementById('closeProfile');
    const logoutBtn = document.getElementById('logoutBtn');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    const sendResetBtn = document.getElementById('sendResetBtn');
    const profileNotice = document.getElementById('profileNotice');
    const profileAvatarImg = document.getElementById('profileAvatarImg');
    const profileInitials = document.getElementById('profileInitials');
    const profileImageInput = document.getElementById('profileImageInput');
    const profileFullName = document.getElementById('profileFullName');
    const profileEmail = document.getElementById('profileEmail');
    const fieldFullName = document.getElementById('fieldFullName');
    const fieldEmail = document.getElementById('fieldEmail');
    const fieldAge = document.getElementById('fieldAge');
    const fieldGrade = document.getElementById('fieldGrade');
    const fieldSection = document.getElementById('fieldSection');
    const fieldPoints = document.getElementById('fieldPoints');
    const fieldVerified = document.getElementById('fieldVerified');
    const lastSynced = document.getElementById('lastSynced');
    const themeCheckbox = document.getElementById('themeCheckbox');
    const deleteAccountBtn = document.getElementById('deleteAccountBtn');

    let currentUid = null;
    let currentProfileDocPath = null; // 'students' or 'verificationRequests'
    let currentProfileData = null;
    let currentPhotoStorageRef = null;
    let uploadedPhotoFile = null;

    // show / hide helpers
    function showPanel() {
      profilePanel.classList.add('open');
      profileOverlay.classList.add('show');
      profilePanel.setAttribute('aria-hidden', 'false');
      profileOverlay.setAttribute('aria-hidden', 'false');
    }
    function hidePanel() {
      profilePanel.classList.remove('open');
      profileOverlay.classList.remove('show');
      profilePanel.setAttribute('aria-hidden', 'true');
      profileOverlay.setAttribute('aria-hidden', 'true');
    }
    logoTrigger.addEventListener('click', (e) => { e.preventDefault(); showPanel(); loadProfile(); });

    closeProfile.addEventListener('click', hidePanel);
    profileOverlay.addEventListener('click', hidePanel);

    // small notification
    function showNotice(msg, ms = 2200) {
      profileNotice.textContent = msg;
      profileNotice.style.display = 'block';
      setTimeout(()=> profileNotice.style.display = 'none', ms);
    }

    // safe set field values
    function setVal(el, v) { if(!el) return; el.value = v ?? ''; }
    function setText(el, v) { if(!el) return; el.textContent = v ?? '‚Äî'; }

    // load profile: check students/{uid} then fallback to verificationRequests/{uid}
    async function loadProfile() {
      const user = auth.currentUser;
      if (!user) {
        // not signed in -> redirect to sign-in page
        console.warn('No user signed in; redirecting to sign in...');
        window.location.href = 'index.html';
        return;
      }
      currentUid = user.uid;
      // try students collection first
      const studentsRef = doc(db, 'students', currentUid);
      const studentSnap = await getDoc(studentsRef);
      if (studentSnap.exists()) {
        currentProfileDocPath = 'students';
        currentProfileData = studentSnap.data();
      } else {
        // fallback to verificationRequests
        const vrRef = doc(db, 'verificationRequests', currentUid);
        const vrSnap = await getDoc(vrRef);
        if (vrSnap.exists()) {
          currentProfileDocPath = 'verificationRequests';
          currentProfileData = vrSnap.data();
        } else {
          // still not found - create a minimal students doc using auth info
          currentProfileDocPath = 'students';
          currentProfileData = {
            firstName: user.displayName || (user.email ? user.email.split('@')[0] : 'Student'),
            lastName: '',
            email: user.email,
            age: null,
            grade: '',
            section: '',
            verified: false,
            points: 0,
            photoURL: null
          };
          // don't auto-write until user saves; show the info
        }
      }

      // fill UI
      const fullName = (currentProfileData.firstName ?? '') + (currentProfileData.lastName ? ' ' + currentProfileData.lastName : '');
      setText(profileFullName, fullName || (user.displayName || 'Student'));
      setText(profileEmail, currentProfileData.email ?? user.email ?? '‚Äî');
      setVal(fieldFullName, fullName);
      setVal(fieldEmail, currentProfileData.email ?? user.email ?? '');
      setVal(fieldAge, currentProfileData.age ?? '');
      setVal(fieldGrade, currentProfileData.grade ?? '');
      setVal(fieldSection, currentProfileData.section ?? '');
      setVal(fieldPoints, String(currentProfileData.points ?? 0));
      setText(fieldVerified, currentProfileData.verified ? 'Verified' : (currentProfileData.status ?? (currentProfileData.verified === false ? 'Not verified' : 'Pending')));
      setText(lastSynced, new Date().toLocaleString());

      // profile picture
      const photoURL = currentProfileData.photoURL ?? null;
      if (photoURL) {
        profileAvatarImg.src = photoURL;
        profileAvatarImg.style.display = '';
        profileInitials.style.display = 'none';
      } else {
        // try storage lookup: expected location profiles/{uid}/profile.jpg
        try {
          const storageRef = sRef(storage, `profiles/${currentUid}/profile.jpg`);
          const url = await getDownloadURL(storageRef);
          profileAvatarImg.src = url;
          profileAvatarImg.style.display = '';
          profileInitials.style.display = 'none';
        } catch (e) {
          // no picture found; show initials
          profileAvatarImg.style.display = 'none';
          profileInitials.style.display = '';
          const initials = (currentProfileData.firstName?.[0] ?? 'E') + (currentProfileData.lastName?.[0] ?? 'T');
          profileInitials.textContent = initials.toUpperCase();
        }
      }

      // disable edit by default
      setEditable(false);
    }

    function setEditable(flag) {
      const editableFields = [fieldFullName, fieldAge, fieldGrade, fieldSection];
      editableFields.forEach(f => f.disabled = !flag);
      if (flag) {
        editProfileBtn.textContent = 'Cancel';
        saveProfileBtn.style.display = '';
      } else {
        editProfileBtn.textContent = 'Edit';
        // keep Save visible but if not editing maybe hide
        // but we keep it visible to allow explicit saving
      }
    }

    editProfileBtn.addEventListener('click', () => {
      const editing = editProfileBtn.textContent === 'Edit';
      setEditable(editing);
    });

    // image upload
    profileImageInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      // small client-side validation
      if (!file.type.startsWith('image/')) return alert('Please select an image file.');
      uploadedPhotoFile = file;
      // show preview immediately
      const url = URL.createObjectURL(file);
      profileAvatarImg.src = url;
      profileAvatarImg.style.display = '';
      profileInitials.style.display = 'none';
    });

    // save profile: upload image if present, then write to students/{uid}
    saveProfileBtn.addEventListener('click', async () => {
      if (!currentUid) return alert('User not loaded.');
      try {
        showNotice('Saving...');
        // prepare data
        const full = (fieldFullName.value || '').trim();
        // try splitting first/last
        let first = full, last = '';
        const parts = full.split(' ').filter(Boolean);
        if (parts.length >= 2) { first = parts.slice(0, -1).join(' '); last = parts.slice(-1).join(' '); }

        const docRef = doc(db, 'students', currentUid);
        const payload = {
          firstName: first,
          lastName: last,
          email: fieldEmail.value || currentProfileData.email || auth.currentUser.email,
          age: fieldAge.value ? Number(fieldAge.value) : null,
          grade: fieldGrade.value || '',
          section: fieldSection.value || '',
          verified: currentProfileData.verified ?? false,
          points: Number(fieldPoints.value || (currentProfileData.points ?? 0)),
          updatedAt: serverTimestamp()
        };

        // if user uploaded a new picture, upload to storage first
        if (uploadedPhotoFile) {
          const pRef = sRef(storage, `profiles/${currentUid}/profile.jpg`);
          await uploadBytes(pRef, uploadedPhotoFile);
          const photoURL = await getDownloadURL(pRef);
          payload.photoURL = photoURL;
          // update avatar display to the new persistent URL
          profileAvatarImg.src = photoURL;
          uploadedPhotoFile = null;
        }

        // write or merge to students collection
        await setDoc(docRef, payload, { merge: true });

        // also update the verificationRequests doc if exists (keep info in sync)
        const vrRef = doc(db, 'verificationRequests', currentUid);
        const vrSnap = await getDoc(vrRef);
        if (vrSnap.exists()) {
          await updateDoc(vrRef, {
            firstName: payload.firstName,
            lastName: payload.lastName,
            email: payload.email,
            requestedAt: vrSnap.data().requestedAt ?? serverTimestamp()
          }).catch(()=>{/* ignore if failed */});
        }

        // reload profile data
        currentProfileData = { ...currentProfileData, ...payload };
        setText(profileFullName, payload.firstName + (payload.lastName ? ' ' + payload.lastName : ''));
        setText(profileEmail, payload.email);
        setText(fieldVerified, payload.verified ? 'Verified' : 'Not verified');
        setVal(fieldPoints, String(payload.points));
        setText(lastSynced, new Date().toLocaleString());
        setEditable(false);
        showNotice('Saved ‚úì', 1600);
      } catch (err) {
        console.error(err);
        alert('Failed to save profile: ' + (err.message || err));
      }
    });

    // logout
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
        // redirect to index after sign out
        window.location.href = 'index.html';
      } catch (e) {
        alert('Logout failed: ' + (e.message || e));
      }
    });

    // send password reset email
    sendResetBtn.addEventListener('click', async () => {
      try {
        const email = fieldEmail.value || (auth.currentUser && auth.currentUser.email);
        if (!email) return alert('No email available to send reset.');
        await sendPasswordResetEmail(auth, email);
        showNotice('Password reset email sent', 2200);
      } catch (e) {
        console.error(e);
        alert('Could not send reset email: ' + (e.message || e));
      }
    });

    // delete account (auth delete requires reauth and admin; here we sign user out and hint)
    deleteAccountBtn.addEventListener('click', () => {
      const ok = confirm('Deleting account from frontend will only remove the Auth session. Full removal requires admin action. Continue and sign out?');
      if (!ok) return;
      signOut(auth).then(()=> window.location.href='index.html');
    });

    // theme toggle: simple data-theme toggle saved to localStorage
    function applyTheme(name) {
      document.documentElement.setAttribute('data-theme', name);
      localStorage.setItem('ecotrack_theme', name);
      // if you want to persist to user doc
    }
    themeCheckbox.addEventListener('change', () => {
      applyTheme(themeCheckbox.checked ? 'dark' : 'light');
    });
    // initialize theme from localStorage
    const savedTheme = localStorage.getItem('ecotrack_theme') || document.documentElement.getAttribute('data-theme') || 'light';
    applyTheme(savedTheme);
    themeCheckbox.checked = savedTheme === 'dark';

    // onAuthStateChanged ensure user is signed in before profile
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        // no user: redirect to login
        // do not redirect if you want to allow demo browsing
        // window.location.href = 'index.html';
        console.log('No user session');
        return;
      } else {
        // preload profile quietly
        // don't force open panel, just make sure data is ready
        currentUid = user.uid;
        // optionally call loadProfile() so it's ready when they click logo
        // but avoid unnecessary reads on page load; we will load when user opens panel
      }
    });

    // accessibility: close with Esc
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') hidePanel();
    });

    </script>

</body>
</html>