<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECOTrack | Sign In & Sign Up</title>

  <style>
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #9be15d, #00e3ae);
      overflow: hidden;
    }
    .container {
      width: 360px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      padding: 30px;
      text-align: center;
      transition: all 0.5s ease;
    }
    h1 { color: #2e7d32; margin-bottom: 20px; }
    form { display: flex; flex-direction: column; gap: 10px; }
    input, select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }
    button {
      background: #2e7d32;
      color: #fff;
      border: none;
      padding: 10px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #1b5e20; }
    .switch { margin-top: 10px; color: #00796b; cursor: pointer; font-size: 14px; }
    .hidden { display: none; }
    .role-switch { margin-bottom: 15px; }
    .role-btn {
      background: #81c784;
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      margin: 0 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    .role-btn.active { background: #2e7d32; color: white; }
    .eco-icon { font-size: 40px; color: #4caf50; animation: float 2s infinite ease-in-out; }
    @keyframes float { 0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);} }
  </style>
</head>
<body>
  <div class="container">
    <div class="eco-icon">ðŸŒ¿</div>
    <h1>ECOTrack</h1>

    <!-- ROLE SWITCH -->
    <div class="role-switch">
      <button id="studentBtn" class="role-btn active">Student</button>
      <button id="teacherBtn" class="role-btn">Teacher</button>
      <button id="adminBtn" class="role-btn">Admin</button>
    </div>

    <!-- STUDENT SIGN IN -->
    <form id="student-signin-form">
      <input id="signin-email" type="email" placeholder="Email" required>
      <input id="signin-password" type="password" placeholder="Password" required>
      <button type="submit">Sign In</button>
      <div class="switch" id="toStudentSignup">Donâ€™t have an account? Sign Up</div>
    </form>

    <!-- STUDENT SIGN UP -->
    <form id="student-signup-form" class="hidden">
      <input id="signup-name" placeholder="Full Name" required>
      <select id="signup-grade" required>
        <option value="">Grade Level</option>
        <option>1</option><option>2</option><option>3</option>
        <option>4</option><option>5</option><option>6</option>
      </select>
      <input id="signup-section" placeholder="Section / Advisory" required>
      <input id="signup-age" type="number" placeholder="Age" required>
      <input id="signup-email" type="email" placeholder="Email" required>
      <input id="signup-password" type="password" placeholder="Password" required>
      <input id="signup-confirm" type="password" placeholder="Confirm Password" required>
      <button type="submit">Sign Up</button>
      <div class="switch" id="toStudentSignin">Already have an account? Sign In</div>
    </form>

    <!-- TEACHER SIGN IN -->
    <form id="teacher-signin-form" class="hidden">
      <input id="teacher-email" type="email" placeholder="Teacher Email" required>
      <input id="teacher-password" type="password" placeholder="Password" required>
      <button type="submit">Sign In</button>
      <div class="switch" id="toTeacherSignup">Create Teacher Account</div>
    </form>

    <!-- TEACHER SIGN UP -->
    <form id="teacher-signup-form" class="hidden">
      <input id="t-name" placeholder="Full Name" required>
      <select id="t-grade" required>
        <option value="">Grade Level</option>
        <option>1</option><option>2</option><option>3</option>
        <option>4</option><option>5</option><option>6</option>
      </select>
      <input id="t-section" placeholder="Section / Advisory" required>
      <input id="t-email" type="email" placeholder="Email" required>
      <input id="t-password" type="password" placeholder="Password" required>
      <input id="t-confirm" type="password" placeholder="Confirm Password" required>
      <button type="submit">Sign Up</button>
      <div class="switch" id="toTeacherSignin">Already have an account? Sign In</div>
    </form>

    <!-- ADMIN SIGN IN -->
    <form id="admin-signin-form" class="hidden">
      <input id="admin-email" type="email" placeholder="Admin Email" required>
      <input id="admin-password" type="password" placeholder="Password" required>
      <button type="submit">Sign In</button>
    </form>
  </div>

  <!-- FIREBASE LOGIC -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
      getFirestore, doc, setDoc, getDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAvblGiAIZ26bIbtw6cSv9kfgzSiYyq_10",
      authDomain: "registar-5f3fb.firebaseapp.com",
      projectId: "registar-5f3fb",
      storageBucket: "registar-5f3fb.firebasestorage.app",
      messagingSenderId: "856198150739",
      appId: "1:856198150739:web:801000f564b47f6333e4a6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* -------------------------- ROLE SWITCH LOGIC -------------------------- */
    const studentBtn = document.getElementById("studentBtn");
    const teacherBtn = document.getElementById("teacherBtn");
    const adminBtn = document.getElementById("adminBtn");

    const studentSignin = document.getElementById("student-signin-form");
    const studentSignup = document.getElementById("student-signup-form");
    const teacherSignin = document.getElementById("teacher-signin-form");
    const teacherSignup = document.getElementById("teacher-signup-form");
    const adminSignin = document.getElementById("admin-signin-form");

    function hideAll() {
      studentSignin.classList.add("hidden");
      studentSignup.classList.add("hidden");
      teacherSignin.classList.add("hidden");
      teacherSignup.classList.add("hidden");
      adminSignin.classList.add("hidden");
    }

    studentBtn.addEventListener("click", () => {
      hideAll();
      studentSignin.classList.remove("hidden");

      studentBtn.classList.add("active");
      teacherBtn.classList.remove("active");
      adminBtn.classList.remove("active");
    });

    teacherBtn.addEventListener("click", () => {
      hideAll();
      teacherSignin.classList.remove("hidden");

      teacherBtn.classList.add("active");
      studentBtn.classList.remove("active");
      adminBtn.classList.remove("active");
    });

    adminBtn.addEventListener("click", () => {
      hideAll();
      adminSignin.classList.remove("hidden");

      adminBtn.classList.add("active");
      studentBtn.classList.remove("active");
      teacherBtn.classList.remove("active");
    });

    /* ---------- STUDENT SWITCH ---------- */
    document.getElementById("toStudentSignup").onclick = () => {
      studentSignin.classList.add("hidden");
      studentSignup.classList.remove("hidden");
    };
    document.getElementById("toStudentSignin").onclick = () => {
      studentSignup.classList.add("hidden");
      studentSignin.classList.remove("hidden");
    };

    /* ---------- TEACHER SWITCH ---------- */
    document.getElementById("toTeacherSignup").onclick = () => {
      teacherSignin.classList.add("hidden");
      teacherSignup.classList.remove("hidden");
    };
    document.getElementById("toTeacherSignin").onclick = () => {
      teacherSignup.classList.add("hidden");
      teacherSignin.classList.remove("hidden");
    };

    /* -------------------------- STUDENT SIGN UP -------------------------- */
    studentSignup.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = signup-name.value;
      const grade = signup-grade.value;
      const section = signup-section.value;
      const age = signup-age.value;
      const email = signup-email.value;
      const password = signup-password.value;
      const confirm = signup-confirm.value;

      if (password !== confirm) return alert("Passwords do not match!");

      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        await setDoc(doc(db, "students", userCred.user.uid), {
          name, grade, section, age, email, verified: false, totalTimeSpent: 0
        });

        alert("Student account created! Waiting for teacher verification.");
        studentSignup.reset();
      } catch (err) {
        alert(err.message);
      }
    });

    /* -------------------------- STUDENT SIGN IN -------------------------- */
    studentSignin.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = signin-email.value;
      const password = signin-password.value;

      try {
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        const snap = await getDoc(doc(db, "students", userCred.user.uid));

        if (!snap.exists()) return alert("Student data not found!");

        if (!snap.data().verified)
          return alert("Your teacher has not verified your account yet.");

        window.location.href = "Echo3.html";
      } catch (err) {
        alert(err.message);
      }
    });

    /* -------------------------- TEACHER SIGN UP -------------------------- */
    teacherSignup.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = t-name.value;
      const grade = t-grade.value;
      const section = t-section.value;
      const email = t-email.value;
      const password = t-password.value;
      const confirm = t-confirm.value;

      if (password !== confirm) return alert("Passwords do not match!");

      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        await setDoc(doc(db, "teachers", userCred.user.uid), {
          name, grade, section, email, verified: false
        });

        alert("Teacher account created! Waiting for admin verification.");
        teacherSignup.reset();
      } catch (err) {
        alert(err.message);
      }
    });

    /* -------------------------- TEACHER SIGN IN -------------------------- */
    teacherSignin.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = teacher-email.value;
      const password = teacher-password.value;

      try {
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        const snap = await getDoc(doc(db, "teachers", userCred.user.uid));

        if (!snap.exists()) return alert("Not registered as teacher!");
        if (!snap.data().verified) return alert("Admin has not verified your account.");

        window.location.href = "verify.html";
      } catch (err) {
        alert(err.message);
      }
    });

    /* -------------------------- ADMIN SIGN IN -------------------------- */
    adminSignin.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = admin-email.value;
      const password = admin-password.value;

      try {
        const userCred = await signInWithEmailAndPassword(auth, email, password);

        if (email !== "ninongry6000@gmail.com") {
          return alert("You are not the admin.");
        }

        window.location.href = "admin.html";
      } catch (err) {
        alert(err.message);
      }
    });

  </script>
</body>
</html>
