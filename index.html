<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECOTrack ‚Äî Unified Design</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box;font-family:'Poppins',sans-serif;margin:0;padding:0}
    body{
      min-height:100vh;
      display:flex;align-items:center;justify-content:center;
      padding:40px;
      background:
        radial-gradient(1000px 600px at 10% 10%, #e5ffe9 0%, transparent 22%),
        linear-gradient(135deg,#f5f2ec,#eafff6,#e7f5ff);
      position:relative;
      overflow:hidden;
    }

    /* TEXTURE overlay */
    .texture{
      position:absolute;inset:0;pointer-events:none;
      background-image:repeating-linear-gradient(120deg, rgba(0,0,0,0.03) 0 1px, transparent 1px 18px);
      opacity:0.25;
    }

    /* FLOATING LEAVES (combined styles) */
    .leaf{position:absolute;top:-8%;width:38px;height:38px;opacity:0.9;
      animation:fall linear infinite, sway ease-in-out infinite;
      filter:drop-shadow(0 6px 10px rgba(0,0,0,0.08));
    }
    .leaf svg{width:100%;height:100%}
    .l1{left:8%;animation-duration:10s;animation-delay:0s}
    .l2{left:26%;animation-duration:12s;animation-delay:1s}
    .l3{left:48%;animation-duration:15s;animation-delay:2s}
    .l4{left:72%;animation-duration:9s;animation-delay:1.3s}
    .l5{left:88%;animation-duration:14s;animation-delay:2.7s}
    @keyframes fall{0%{transform:translateY(-10vh) rotate(0deg)}100%{transform:translateY(120vh) rotate(360deg)}}
    @keyframes sway{0%{transform:translateX(0)}50%{transform:translateX(12px)}100%{transform:translateX(0)}}

    /* MAIN CARD */
    .container{
      width:min(900px,98vw);
      background:linear-gradient(180deg, rgba(255,255,255,0.82), rgba(255,255,255,0.65));
      box-shadow:0 22px 44px rgba(0,0,0,0.10);
      border-radius:20px;
      backdrop-filter:blur(10px);
      padding:28px;
      display:grid;grid-template-columns:1fr 420px;gap:24px;
      position:relative;z-index:3;
    }

    /* LEFT PANEL */
    .left{
      padding:22px;
    }
    .hero{
      display:flex;align-items:center;gap:14px;
    }
    .mascot{
      width:74px;height:74px;border-radius:16px;
      background:linear-gradient(135deg,#66bb6a,#43a047,#2e7d32);
      display:flex;align-items:center;justify-content:center;
      color:white;font-size:34px;font-weight:700;
      box-shadow:0 12px 20px rgba(46,125,50,0.25);
    }
    h1{font-size:28px;color:#1b5e20;margin-bottom:4px}
    p.lead{color:#4b4b4b;margin-bottom:12px}

    .bins{display:flex;gap:12px;margin-top:16px}
    .bin{
      flex:1;padding:10px;border-radius:14px;text-align:center;
      background:rgba(255,255,255,0.7);
      box-shadow:0 12px 26px rgba(0,0,0,0.06);
    }
    .bin small{color:#6b6b6b;display:block}

    /* RIGHT PANEL */
    .right{
      padding:20px;
      background:linear-gradient(180deg,#f7fff7,#ffffff,#fffaf0);
      border-radius:14px;
      box-shadow:0 12px 24px rgba(0,0,0,0.05);
    }

    .roles{display:flex;gap:8px;justify-content:center;margin-bottom:14px}
    .role-btn{
      padding:10px 16px;border-radius:999px;
      border:2px dashed rgba(46,125,50,0.25);
      background:white;cursor:pointer;font-weight:500;
    }
    .role-btn.active{
      background:#2e7d32;color:white;border:none;
      box-shadow:0 10px 22px rgba(46,125,50,0.25);
    }

    form{display:flex;flex-direction:column;gap:10px}
    input,select{
      padding:12px;border-radius:10px;
      border:1px solid #e0e0e0;font-size:14px;
      background:rgba(255,255,255,0.85);
    }
    button{
      padding:12px;border-radius:10px;
      border:none;background:#2e7d32;color:white;
      font-weight:600;cursor:pointer;
    }
    button:hover{background:#1b5e20}

    .switch{text-align:center;color:#2e7d32;font-size:13px;cursor:pointer}
    small.note{color:#757575}

    @media(max-width:880px){
      .container{grid-template-columns:1fr}
      .left{order:2}
      .right{order:1}
    }
  </style>
</head>
<body>

  <div class="texture"></div>

  <!-- LEAVES -->
  <div class="leaf l1"><svg viewBox="0 0 24 24"><path d="M21 3c-6 4-10 6-18 6 3 4 6 8 18 12-6-4-4-8 0-18z" fill="#8BC34A"/></svg></div>
  <div class="leaf l2"><svg viewBox="0 0 24 24"><path d="M21 3c-6 4-10 6-18 6 3 4 6 8 18 12-6-4-4-8 0-18z" fill="#66BB6A"/></svg></div>
  <div class="leaf l3"><svg viewBox="0 0 24 24"><path d="M21 3c-6 4-10 6-18 6 3 4 6 8 18 12-6-4-4-8 0-18z" fill="#9CCC65"/></svg></div>
  <div class="leaf l4"><svg viewBox="0 0 24 24"><path d="M21 3c-6 4-10 6-18 6 3 4 6 8 18 12-6-4-4-8 0-18z" fill="#7CB342"/></svg></div>
  <div class="leaf l5"><svg viewBox="0 0 24 24"><path d="M21 3c-6 4-10 6-18 6 3 4 6 8 18 12-6-4-4-8 0-18z" fill="#558B2F"/></svg></div>


  <div class="container">

    <!-- LEFT SIDE -->
    <div class="left">
      <div class="hero">
        <div class="mascot">‚ôªÔ∏è</div>
        <div>
          <h1>ECOTrack</h1>
          <p class="lead">Clean campus. Smart tracking. Earn rewards.</p>
        </div>
      </div>

      <div class="bins">
        <div class="bin"><div style="font-size:22px">‚ôªÔ∏è</div><small>Recyclables</small></div>
        <div class="bin"><div style="font-size:22px">üçÉ</div><small>Compost</small></div>
        <div class="bin"><div style="font-size:22px">üóëÔ∏è</div><small>Residual</small></div>
      </div>
    </div>


    <!-- RIGHT SIDE: ALL YOUR ORIGINAL FORMS (unchanged IDs) -->
    <div class="right">

      <div class="roles">
        <button id="studentBtn" class="role-btn active">Student</button>
        <button id="teacherBtn" class="role-btn">Teacher</button>
        <button id="adminBtn" class="role-btn">Admin</button>
      </div>

      <!-- STUDENT SIGN IN -->
      <form id="student-signin-form">
        <input id="signin-email" type="email" placeholder="Email" required>
        <input id="signin-password" type="password" placeholder="Password" required>
        <button type="submit">Sign In</button>
        <div class="switch" id="toStudentSignup">Don‚Äôt have an account? Sign Up</div>
        <small class="note">Students need teacher verification before signing in.</small>
      </form>

      <!-- STUDENT SIGN UP -->
      <form id="student-signup-form" class="hidden">
        <input id="signup-name" placeholder="Full Name" required>
        <select id="signup-grade" required>
          <option value="">Grade Level</option>
          <option value="Grade 1">Grade 1</option><option value="Grade 2">Grade 2</option>
          <option value="Grade 3">Grade 3</option><option value="Grade 4">Grade 4</option>
          <option value="Grade 5">Grade 5</option><option value="Grade 6">Grade 6</option>
        </select>
        <input id="signup-section" placeholder="Section / Advisory" required>
        <input id="signup-age" type="number" placeholder="Age" required>
        <input id="signup-email" type="email" placeholder="Email" required>
        <input id="signup-password" type="password" placeholder="Password" required>
        <input id="signup-confirm" type="password" placeholder="Confirm Password" required>
        <button type="submit">Sign Up</button>
        <div class="switch" id="toStudentSignin">Already have an account? Sign In</div>
      </form>

      <!-- TEACHER SIGN IN -->
      <form id="teacher-signin-form" class="hidden">
        <input id="teacher-email" type="email" placeholder="Teacher Email" required>
        <input id="teacher-password" type="password" placeholder="Password" required>
        <button type="submit">Sign In</button>
        <div class="switch" id="toTeacherSignup">Create Teacher Account</div>
        <small class="note">Teachers need admin approval before signing in.</small>
      </form>

      <!-- TEACHER SIGN UP -->
      <form id="teacher-signup-form" class="hidden">
        <input id="t-name" placeholder="Full Name" required>
        <select id="t-grade" required>
          <option value="">Grade Level</option>
          <option value="Grade 1">Grade 1</option><option value="Grade 2">Grade 2</option>
          <option value="Grade 3">Grade 3</option><option value="Grade 4">Grade 4</option>
          <option value="Grade 5">Grade 5</option><option value="Grade 6">Grade 6</option>
        </select>
        <input id="t-section" placeholder="Section / Advisory" required>
        <input id="t-email" type="email" placeholder="Email" required>
        <input id="t-password" type="password" placeholder="Password" required>
        <input id="t-confirm" type="password" placeholder="Confirm Password" required>
        <button type="submit">Sign Up</button>
        <div class="switch" id="toTeacherSignin">Already have an account? Sign In</div>
      </form>

      <!-- ADMIN SIGN IN -->
      <form id="admin-signin-form" class="hidden">
        <input id="admin-email" type="email" placeholder="Admin Email" required>
        <input id="admin-password" type="password" placeholder="Password" required>
        <button type="submit">Sign In</button>
        <small class="note">Admin sign-in only ‚Äî no signup here.</small>
      </form>

    </div>
  </div>


  <!-- UI SWITCH SCRIPT (kept same) -->
  <script type="module">
/* ‚Äî‚Äî‚Äî FIREBASE IMPORTS ‚Äî‚Äî‚Äî */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ‚Äî‚Äî‚Äî FIREBASE CONFIG ‚Äî‚Äî‚Äî */
const firebaseConfig = {
  apiKey: "AIzaSyAvblGiAIZ26bIbtw6cSv9kfgzSiYyq_10",
  authDomain: "registar-5f3fb.firebaseapp.com",
  projectId: "registar-5f3fb",
  storageBucket: "registar-5f3fb.firebasestorage.app",
  messagingSenderId: "856198150739",
  appId: "1:856198150739:web:801000f564b47f6333e4a6"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ‚Äî‚Äî‚Äî ELEMENTS ‚Äî‚Äî‚Äî */
const studentBtn = document.getElementById("studentBtn");
const teacherBtn = document.getElementById("teacherBtn");
const adminBtn = document.getElementById("adminBtn");

const studentSignin = document.getElementById("student-signin-form");
const studentSignup = document.getElementById("student-signup-form");
const teacherSignin = document.getElementById("teacher-signin-form");
const teacherSignup = document.getElementById("teacher-signup-form");
const adminSignin = document.getElementById("admin-signin-form");

const toStudentSignup = document.getElementById("toStudentSignup");
const toStudentSignin = document.getElementById("toStudentSignin");
const toTeacherSignup = document.getElementById("toTeacherSignup");
const toTeacherSignin = document.getElementById("toTeacherSignin");

/* ‚Äî‚Äî‚Äî SIMPLE UI SWITCHING ‚Äî‚Äî‚Äî */
function hideAll() {
  studentSignin.classList.add("hidden");
  studentSignup.classList.add("hidden");
  teacherSignin.classList.add("hidden");
  teacherSignup.classList.add("hidden");
  adminSignin.classList.add("hidden");
}

studentBtn.onclick = () => { hideAll(); studentSignin.classList.remove("hidden"); studentBtn.classList.add("active"); teacherBtn.classList.remove("active"); adminBtn.classList.remove("active"); };
teacherBtn.onclick = () => { hideAll(); teacherSignin.classList.remove("hidden"); teacherBtn.classList.add("active"); studentBtn.classList.remove("active"); adminBtn.classList.remove("active"); };
adminBtn.onclick = () => { hideAll(); adminSignin.classList.remove("hidden"); adminBtn.classList.add("active"); studentBtn.classList.remove("active"); teacherBtn.classList.remove("active"); };

toStudentSignup.onclick = () => { studentSignin.classList.add("hidden"); studentSignup.classList.remove("hidden"); };
toStudentSignin.onclick = () => { studentSignup.classList.add("hidden"); studentSignin.classList.remove("hidden"); };

toTeacherSignup.onclick = () => { teacherSignin.classList.add("hidden"); teacherSignup.classList.remove("hidden"); };
toTeacherSignin.onclick = () => { teacherSignup.classList.add("hidden"); teacherSignin.classList.remove("hidden"); };

/* helper */
const $ = id => document.getElementById(id);

/* STUDENT SIGN UP */
studentSignup.addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = $("signup-name").value.trim();
  const grade = $("signup-grade").value;
  const section = $("signup-section").value.trim();
  const age = Number($("signup-age").value);
  const email = $("signup-email").value.trim();
  const password = $("signup-password").value;
  const confirm = $("signup-confirm").value;

  if (!name || !grade || !section || !email || !password) return alert("Please fill all fields.");
  if (email.length > 30) return alert("Email must be at most 30 characters.");
  if (password.length > 22) return alert("Password must be at most 22 characters.");
  if (password !== confirm) return alert("Passwords do not match.");
  if (section.length > 18) return alert("Section/advisory must be at most 18 characters.");

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    const uid = cred.user.uid;

    await setDoc(doc(db, "verificationRequests", uid), {
      studentId: uid,
      firstName: name,
      lastName: "",
      middleInitial: "",
      email,
      age: isFinite(age) ? age : null,
      grade,
      section,
      status: "pending",
      requestedAt: serverTimestamp()
    });

    alert("Sign-up successful. Wait for your teacher to verify your account.");
    hideAll();
    studentSignin.classList.remove("hidden");
  } catch (err) {
    alert(err.message || "Sign up failed.");
  }
});

/* STUDENT SIGN IN */
studentSignin.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = $("signin-email").value.trim();
  const password = $("signin-password").value;

  if (email.length > 30) return alert("Email must be at most 30 characters.");
  if (password.length > 22) return alert("Password must be at most 22 characters.");

  try {
    const userCred = await signInWithEmailAndPassword(auth, email, password);
    const uid = userCred.user.uid;
    const snap = await getDoc(doc(db, "students", uid));
    if (!snap.exists()) return alert("Student profile not found. Are you verified?");
    if (!snap.data().verified) return alert("Your account is not yet verified.");
    window.location.href = "Echo3.html";
  } catch (err) {
    alert(err.message || "Sign in failed.");
  }
});

/* TEACHER SIGN UP */
teacherSignup.addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = $("t-name").value.trim();
  const grade = $("t-grade").value;
  const section = $("t-section").value.trim();
  const email = $("t-email").value.trim();
  const password = $("t-password").value;
  const confirm = $("t-confirm").value;

  if (!name || !grade || !section || !email || !password) return alert("Fill all fields.");
  if (email.length > 30) return alert("Email max 30 chars.");
  if (password.length > 22) return alert("Password max 22 chars.");
  if (password !== confirm) return alert("Passwords don't match.");
  if (section.length > 18) return alert("Section max 18 chars.");

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    const uid = cred.user.uid;

    await setDoc(doc(db, "teacherVerificationRequests", uid), {
      teacherId: uid,
      firstName: name,
      lastName: "",
      middleInitial: "",
      email,
      advisoryGrade: grade,
      advisorySection: section,
      status: "pending",
      requestedAt: serverTimestamp()
    });

    alert("Teacher account created. Wait for admin approval.");
    hideAll();
    teacherSignin.classList.remove("hidden");
  } catch (err) {
    alert(err.message || "Sign up failed.");
  }
});

/* TEACHER SIGN IN */
teacherSignin.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = $("teacher-email").value.trim();
  const password = $("teacher-password").value;

  if (email.length > 30) return alert("Email must be at most 30 characters.");
  if (password.length > 22) return alert("Password must be at most 22 characters.");

  try {
    const userCred = await signInWithEmailAndPassword(auth, email, password);
    const uid = userCred.user.uid;

    const snap = await getDoc(doc(db, "teachers", uid));
    if (!snap.exists()) {
      alert("Teacher account not approved yet or profile missing.");
      await signOut(auth);
      return;
    }
    const data = snap.data();
    if (!data.verified) {
      await signOut(auth);
      return alert("Admin has not approved your account yet.");
    }

    window.location.href = "verify.html";
  } catch (err) {
    alert(err.message || "Teacher sign in failed.");
  }
});

/* ADMIN SIGN IN */
adminSignin.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = $("admin-email").value.trim();
  const password = $("admin-password").value;

  if (email.length > 30) return alert("Email must be at most 30 characters.");
  if (password.length > 22) return alert("Password must be at most 22 characters.");

  try {
    const userCred = await signInWithEmailAndPassword(auth, email, password);
    const uid = userCred.user.uid;
    const adminSnap = await getDoc(doc(db, "admins", uid));

    if (!adminSnap.exists()) {
      await signOut(auth);
      return alert("Admin access denied.");
    }

    window.location.href = "admin.html";
  } catch (err) {
    alert(err.message || "Admin sign in failed.");
  }
});
</script>

</body>
</html>