<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECOTrack | Sign In & Sign Up</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #9be15d, #00e3ae);
      overflow: hidden;
    }

    .container {
      width: 360px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      padding: 30px;
      text-align: center;
      transition: all 0.5s ease;
    }

    h1 {
      color: #2e7d32;
      margin-bottom: 20px;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    input,
    select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }

    button {
      background: #2e7d32;
      color: #fff;
      border: none;
      padding: 10px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #1b5e20;
    }

    .switch {
      margin-top: 10px;
      color: #00796b;
      cursor: pointer;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }

    .role-switch {
      margin-bottom: 15px;
    }

    .role-btn {
      background: #81c784;
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      margin: 0 5px;
      cursor: pointer;
      transition: 0.3s;
    }

    .role-btn.active {
      background: #2e7d32;
      color: white;
    }

    .eco-icon {
      font-size: 40px;
      color: #4caf50;
      animation: float 2s infinite ease-in-out;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    .alert {
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
  <div class="container">
    <div class="eco-icon">ðŸŒ¿</div>
    <h1>ECOTrack</h1>

    <div id="alert-container"></div>

    <div class="role-switch">
      <button id="studentBtn" class="role-btn active">Student</button>
      <button id="teacherBtn" class="role-btn">Teacher</button>
    </div>

    <!-- STUDENT SIGN UP -->
    <form id="student-signup-form">
      <input id="signup-name" placeholder="Full Name" required>
      <select id="signup-grade" required>
        <option value="">Grade Level</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>6</option>
      </select>
      <input id="signup-age" type="number" placeholder="Age" required>
      <input id="signup-email" type="email" placeholder="Email" required>
      <input id="signup-password" type="password" placeholder="Password" required>
      <input id="signup-confirm" type="password" placeholder="Confirm Password" required>
      <button type="submit">Sign Up</button>
      <div class="switch" id="toStudentSignin">Already have an account? Sign In</div>
    </form>

    <!-- STUDENT SIGN IN -->
    <form id="student-signin-form" class="hidden">
      <input id="signin-email" type="email" placeholder="Email" required>
      <input id="signin-password" type="password" placeholder="Password" required>
      <button type="submit">Sign In</button>
      <div class="switch" id="toStudentSignup">Don't have an account? Sign Up</div>
    </form>

    <!-- TEACHER SIGN IN -->
    <form id="teacher-signin-form" class="hidden">
      <input id="teacher-email" type="email" placeholder="Teacher Email" required>
      <input id="teacher-password" type="password" placeholder="Password" required>
      <button type="submit">Sign In</button>
    </form>
  </div>

  <script type="module">
    // Firebase SDK Imports
    import { app, auth, database } from "./firebase-config.js";
    import { createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Alert functions
    function showAlert(message, type) {
      const alertContainer = document.getElementById('alert-container');
      alertContainer.className = `alert alert-${type}`;
      alertContainer.textContent = message;
      alertContainer.style.display = 'block';
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        alertContainer.style.display = 'none';
      }, 5000);
    }

    // Form Switching
    const studentBtn = document.getElementById("studentBtn");
    const teacherBtn = document.getElementById("teacherBtn");
    const studentSignupForm = document.getElementById("student-signup-form");
    const studentSigninForm = document.getElementById("student-signin-form");
    const teacherSigninForm = document.getElementById("teacher-signin-form");
    const toStudentSignin = document.getElementById("toStudentSignin");
    const toStudentSignup = document.getElementById("toStudentSignup");

    studentBtn.addEventListener("click", () => {
      studentBtn.classList.add("active");
      teacherBtn.classList.remove("active");
      studentSignupForm.classList.remove("hidden");
      studentSigninForm.classList.add("hidden");
      teacherSigninForm.classList.add("hidden");
    });

    teacherBtn.addEventListener("click", () => {
      teacherBtn.classList.add("active");
      studentBtn.classList.remove("active");
      studentSignupForm.classList.add("hidden");
      studentSigninForm.classList.add("hidden");
      teacherSigninForm.classList.remove("hidden");
    });

    toStudentSignin.addEventListener("click", () => {
      studentSignupForm.classList.add("hidden");
      studentSigninForm.classList.remove("hidden");
    });

    toStudentSignup.addEventListener("click", () => {
      studentSigninForm.classList.add("hidden");
      studentSignupForm.classList.remove("hidden");
    });

    // Student Sign Up
    studentSignupForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("signup-name").value;
      const grade = document.getElementById("signup-grade").value;
      const age = document.getElementById("signup-age").value;
      const email = document.getElementById("signup-email").value;
      const password = document.getElementById("signup-password").value;
      const confirm = document.getElementById("signup-confirm").value;

      if (password !== confirm) {
        showAlert("Passwords do not match!", "error");
        return;
      }

      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          set(ref(database, "students/" + user.uid), {
            name: name,
            grade: grade,
            age: age,
            email: email,
            verified: false, // Initially not verified
            createdAt: new Date().toISOString(),
            totalTimeSpent: 0 // Initialize time tracking
          }).then(() => {
            showAlert("Sign-up successful! Please wait for teacher verification.", "success");
            // Reset form
            studentSignupForm.reset();
          });
        })
        .catch((error) => {
          showAlert(error.message, "error");
        });
    });

    // Student Sign In
    studentSigninForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("signin-email").value;
      const password = document.getElementById("signin-password").value;

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          
          // Check if student is verified
          const studentRef = ref(database, "students/" + user.uid);
          get(studentRef).then((snapshot) => {
            if (snapshot.exists()) {
              const studentData = snapshot.val();
              if (studentData.verified) {
                showAlert("Welcome back! Redirecting...", "success");
                // Start session tracking
                sessionStorage.setItem('startTime', new Date().getTime());
                window.location.href = "Echo3.html"; // Student redirect
              } else {
                showAlert("Account not verified yet. Please wait for teacher verification.", "error");
                // Sign out the user since they're not verified
                auth.signOut();
              }
            } else {
              showAlert("Student data not found.", "error");
            }
          });
        })
        .catch((error) => {
          showAlert(error.message, "error");
        });
    });

    // Teacher Sign In
    teacherSigninForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("teacher-email").value;
      const password = document.getElementById("teacher-password").value;

      // For demo purposes, we'll check if it's a teacher email
      // In a real app, you'd have a separate teachers collection
      if (email === "teacher@ecotrack.com" && password === "teacher123") {
        showAlert("Welcome Teacher!", "success");
        setTimeout(() => {
          window.location.href = "verify.html"; // Teacher redirect
        }, 1500);
      } else {
        showAlert("Invalid teacher credentials.", "error");
      }
    });
  </script>
</body>
</html>