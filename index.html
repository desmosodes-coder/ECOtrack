<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECOTrack | Sign In & Sign Up</title>

  <style>
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #9be15d, #00e3ae);
    }
    .container {
      width: 360px;
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
      text-align: center;
    }
    h1 { color: #2e7d32; margin-bottom: 20px; }
    form { display: flex; flex-direction: column; gap: 10px; }
    input, select {
      padding: 10px; border-radius: 8px;
      border: 1px solid #ccc; font-size: 14px;
    }
    button {
      background: #2e7d32; color: #fff;
      border: none; padding: 10px;
      border-radius: 8px; cursor: pointer;
    }
    button:hover { background:#1b5e20; }
    .hidden { display: none; }
    .role-btn {
      background:#81c784; border:none;
      border-radius:20px; padding:8px 16px;
      margin:0 5px; cursor:pointer;
    }
    .role-btn.active { background:#2e7d32; color:white; }
    .switch { cursor:pointer; font-size:14px; color:#00796b; margin-top:5px; }
  </style>
</head>
<body>

<div class="container">
  <h1>ECOTrack</h1>

  <!-- ROLE SWITCH -->
  <div>
    <button id="studentBtn" class="role-btn active">Student</button>
    <button id="teacherBtn" class="role-btn">Teacher</button>
    <button id="adminBtn" class="role-btn">Admin</button>
  </div>

  <!-- STUDENT SIGN IN -->
  <form id="student-signin-form">
    <input id="signin-email" type="email" placeholder="Email" maxlength="25" required>
    <input id="signin-password" type="password" placeholder="Password" maxlength="30" required>
    <button type="submit">Sign In</button>
    <div class="switch" id="toStudentSignup">Don’t have an account? Sign Up</div>
  </form>

  <!-- STUDENT SIGN UP -->
  <form id="student-signup-form" class="hidden">
    <input id="signup-name" placeholder="Full Name" required>
    <select id="signup-grade" required>
      <option value="">Grade Level</option>
      <option>1</option><option>2</option><option>3</option>
      <option>4</option><option>5</option><option>6</option>
    </select>
    <input id="signup-section" placeholder="Section / Advisory" required>
    <input id="signup-age" type="number" placeholder="Age" required>
    <input id="signup-email" type="email" placeholder="Email" maxlength="25" required>
    <input id="signup-password" type="password" placeholder="Password" maxlength="30" required>
    <input id="signup-confirm" type="password" placeholder="Confirm Password" maxlength="30" required>
    <button type="submit">Sign Up</button>
    <div class="switch" id="toStudentSignin">Already have an account? Sign In</div>
  </form>

  <!-- TEACHER SIGN IN -->
  <form id="teacher-signin-form" class="hidden">
    <input id="teacher-email" type="email" placeholder="Teacher Email" maxlength="25" required>
    <input id="teacher-password" type="password" placeholder="Password" maxlength="30" required>
    <button type="submit">Sign In</button>
    <div class="switch" id="toTeacherSignup">Create Teacher Account</div>
  </form>

  <!-- TEACHER SIGN UP -->
  <form id="teacher-signup-form" class="hidden">
    <input id="t-name" placeholder="Full Name" required>
    <select id="t-grade" required>
      <option value="">Grade Level</option>
      <option>1</option><option>2</option><option>3</option>
      <option>4</option><option>5</option><option>6</option>
    </select>
    <input id="t-section" placeholder="Section / Advisory" required>
    <input id="t-email" type="email" placeholder="Email" maxlength="25" required>
    <input id="t-password" type="password" placeholder="Password" maxlength="30" required>
    <input id="t-confirm" type="password" placeholder="Confirm Password" maxlength="30" required>
    <button type="submit">Sign Up</button>
    <div class="switch" id="toTeacherSignin">Already have an account? Sign In</div>
  </form>

  <!-- ADMIN SIGN IN -->
  <form id="admin-signin-form" class="hidden">
    <input id="admin-email" type="email" placeholder="Admin Email" maxlength="25" required>
    <input id="admin-password" type="password" placeholder="Password" maxlength="30" required>
    <button type="submit">Sign In</button>
  </form>

</div>

<script type="module">

/* ——— FIREBASE IMPORTS ——— */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword }
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc }
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ——— FIREBASE CONFIG ——— */
const firebaseConfig = {
  apiKey: "AIzaSyAvblGiAIZ26bIbtw6cSv9kfgzSiYyq_10",
  authDomain: "registar-5f3fb.firebaseapp.com",
  projectId: "registar-5f3fb",
  storageBucket: "registar-5f3fb.firebasestorage.app",
  messagingSenderId: "856198150739",
  appId: "1:856198150739:web:801000f564b47f6333e4a6"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ——— ELEMENTS ——— */
const studentBtn = document.getElementById("studentBtn");
const teacherBtn = document.getElementById("teacherBtn");
const adminBtn = document.getElementById("adminBtn");

const studentSignin = document.getElementById("student-signin-form");
const studentSignup = document.getElementById("student-signup-form");
const teacherSignin = document.getElementById("teacher-signin-form");
const teacherSignup = document.getElementById("teacher-signup-form");
const adminSignin = document.getElementById("admin-signin-form");

function hideAll() {
  studentSignin.classList.add("hidden");
  studentSignup.classList.add("hidden");
  teacherSignin.classList.add("hidden");
  teacherSignup.classList.add("hidden");
  adminSignin.classList.add("hidden");
}

/* ——— ROLE SWITCHING ——— */
studentBtn.onclick = () => { hideAll(); studentSignin.classList.remove("hidden"); studentBtn.classList.add("active"); teacherBtn.classList.remove("active"); adminBtn.classList.remove("active"); };
teacherBtn.onclick = () => { hideAll(); teacherSignin.classList.remove("hidden"); teacherBtn.classList.add("active"); studentBtn.classList.remove("active"); adminBtn.classList.remove("active"); };
adminBtn.onclick = () => { hideAll(); adminSignin.classList.remove("hidden"); adminBtn.classList.add("active"); studentBtn.classList.remove("active"); teacherBtn.classList.remove("active"); };

toStudentSignup.onclick = () => { studentSignin.classList.add("hidden"); studentSignup.classList.remove("hidden"); };
toStudentSignin.onclick = () => { studentSignup.classList.add("hidden"); studentSignin.classList.remove("hidden"); };

toTeacherSignup.onclick = () => { teacherSignin.classList.add("hidden"); teacherSignup.classList.remove("hidden"); };
toTeacherSignin.onclick = () => { teacherSignup.classList.add("hidden"); teacherSignin.classList.remove("hidden"); };

/* ————————————————————————————————————————————
   STUDENT SIGN UP  ✔ Email ≤25  ✔ Password ≤30
———————————————————————————————————————————— */
studentSignup.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = signup-name.value;
  const grade = signup-grade.value;
  const section = signup-section.value;
  const age = signup-age.value;
  const email = signup-email.value;
  const password = signup-password.value;
  const confirm = signup-confirm.value;

  if (email.length > 25) return alert("Email must not exceed 25 characters.");
  if (password.length > 30) return alert("Password must not exceed 30 characters.");
  if (confirm.length > 30) return alert("Password confirmation must not exceed 30 characters.");
  if (password !== confirm) return alert("Passwords do not match!");

  try {
    const user = (await createUserWithEmailAndPassword(auth, email, password)).user;

    await setDoc(doc(db, "students", user.uid), {
      name, grade, section, age, email, verified: false, totalTimeSpent: 0
    });

    alert("Student created! Waiting for teacher verification.");
  } catch (err) { alert(err.message); }
});

/* ————————————————————————————————————————————
   STUDENT SIGN IN  ✔ Email ≤25  ✔ Password ≤30
———————————————————————————————————————————— */
studentSignin.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = signin-email.value;
  const password = signin-password.value;

  if (email.length > 25) return alert("Email must not exceed 25 characters.");
  if (password.length > 30) return alert("Password must not exceed 30 characters.");

  try {
    const user = (await signInWithEmailAndPassword(auth, email, password)).user;
    const snap = await getDoc(doc(db, "students", user.uid));

    if (!snap.exists()) return alert("Student data missing!");
    if (!snap.data().verified) return alert("Your teacher has not verified your account.");

    window.location.href = "Echo3.html";
  } catch (err) { alert(err.message); }
});

/* ————————————————————————————————————————————
   TEACHER SIGN UP  ✔ Email ≤25  ✔ Password ≤30
———————————————————————————————————————————— */
teacherSignup.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = t-name.value;
  const grade = t-grade.value;
  const section = t-section.value;
  const email = t-email.value;
  const password = t-password.value;
  const confirm = t-confirm.value;

  if (email.length > 25) return alert("Email must not exceed 25 characters.");
  if (password.length > 30) return alert("Password must not exceed 30 characters.");
  if (confirm.length > 30) return alert("Password confirmation must not exceed 30 characters.");
  if (password !== confirm) return alert("Passwords do not match!");

  try {
    const user = (await createUserWithEmailAndPassword(auth, email, password)).user;

    await setDoc(doc(db, "teachers", user.uid), {
      name, grade, section, email, verified: false
    });

    alert("Teacher created! Waiting for admin verification.");
  } catch (err) { alert(err.message); }
});

/* ————————————————————————————————————————————
   TEACHER SIGN IN  ✔ Email ≤25  ✔ Password ≤30
———————————————————————————————————————————— */
teacherSignin.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = teacher-email.value;
  const password = teacher-password.value;

  if (email.length > 25) return alert("Email must not exceed 25 characters.");
  if (password.length > 30) return alert("Password must not exceed 30 characters.");

  try {
    const user = (await signInWithEmailAndPassword(auth, email, password)).user;
    const snap = await getDoc(doc(db, "teachers", user.uid));

    if (!snap.exists()) return alert("Not a teacher account!");
    if (!snap.data().verified) return alert("Admin has not verified your account.");

    window.location.href = "verify.html";
  } catch (err) { alert(err.message); }
});

/* ————————————————————————————————————————————
   ADMIN SIGN IN  ✔ Email ≤25  ✔ Password ≤30
———————————————————————————————————————————— */
adminSignin.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = admin-email.value;
  const password = admin-password.value;

  if (email.length > 25) return alert("Email must not exceed 25 characters.");
  if (password.length > 30) return alert("Password must not exceed 30 characters.");

  try {
    const user = (await signInWithEmailAndPassword(auth, email, password)).user;
    const adminSnap = await getDoc(doc(db, "admins", user.uid));

    if (!adminSnap.exists()) {
      alert("You are NOT an admin.");
      return;
    }

    window.location.href = "admin.html";
  } catch (err) { alert(err.message); }
});

</script>

</body>
</html>
